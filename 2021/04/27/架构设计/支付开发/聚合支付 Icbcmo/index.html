<!DOCTYPE html>
<html lang=en>
<head><meta name="generator" content="Hexo 3.9.0">
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="description" content="公司官网：https://www.icbc.com.mo开发文档：https://app.icbcmo.site/gitbook Login name: ebyte Password: ebyte 工銀澳門聚合支付 Plus。 发起支付微信小程序支付123456789101112131415161718192021222324252627282930313233343536373839404142">
<meta property="og:type" content="article">
<meta property="og:title" content="聚合支付 Icbcmo">
<meta property="og:url" content="http://yoursite.com/2021/04/27/架构设计/支付开发/聚合支付 Icbcmo/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="公司官网：https://www.icbc.com.mo开发文档：https://app.icbcmo.site/gitbook Login name: ebyte Password: ebyte 工銀澳門聚合支付 Plus。 发起支付微信小程序支付123456789101112131415161718192021222324252627282930313233343536373839404142">
<meta property="og:locale" content="en">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/zhangqinghua/hexo_image/20210608180002.png">
<meta property="og:updated_time" content="2021-06-09T05:21:27.180Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="聚合支付 Icbcmo">
<meta name="twitter:description" content="公司官网：https://www.icbc.com.mo开发文档：https://app.icbcmo.site/gitbook Login name: ebyte Password: ebyte 工銀澳門聚合支付 Plus。 发起支付微信小程序支付123456789101112131415161718192021222324252627282930313233343536373839404142">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/zhangqinghua/hexo_image/20210608180002.png">
    
    
        
          
              <link rel="shortcut icon" href="/images/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
          
        
    
    <!-- title -->
    <title>聚合支付 Icbcmo</title>
    <!-- styles -->
    <link rel="stylesheet" href="/css/style.css">
    <!-- persian styles -->
    
      <link rel="stylesheet" href="/css/rtl.css">
    
    <!-- rss -->
    
    
</head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Articles</a></li>
         
          <li><a href="/categories/">Categories</a></li>
         
          <li><a href="/search/">Search</a></li>
         
          <li><a href="/about/">About</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/2021/04/27/架构设计/支付开发/聚合支付 Stripe/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" href="/2021/04/27/架构设计/支付开发/聚合支付 SwiftPass/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://yoursite.com/2021/04/27/架构设计/支付开发/聚合支付 Icbcmo/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://yoursite.com/2021/04/27/架构设计/支付开发/聚合支付 Icbcmo/&text=聚合支付 Icbcmo"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://yoursite.com/2021/04/27/架构设计/支付开发/聚合支付 Icbcmo/&title=聚合支付 Icbcmo"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://yoursite.com/2021/04/27/架构设计/支付开发/聚合支付 Icbcmo/&is_video=false&description=聚合支付 Icbcmo"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=聚合支付 Icbcmo&body=Check out this article: http://yoursite.com/2021/04/27/架构设计/支付开发/聚合支付 Icbcmo/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://yoursite.com/2021/04/27/架构设计/支付开发/聚合支付 Icbcmo/&title=聚合支付 Icbcmo"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://yoursite.com/2021/04/27/架构设计/支付开发/聚合支付 Icbcmo/&title=聚合支付 Icbcmo"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://yoursite.com/2021/04/27/架构设计/支付开发/聚合支付 Icbcmo/&title=聚合支付 Icbcmo"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://yoursite.com/2021/04/27/架构设计/支付开发/聚合支付 Icbcmo/&title=聚合支付 Icbcmo"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://yoursite.com/2021/04/27/架构设计/支付开发/聚合支付 Icbcmo/&name=聚合支付 Icbcmo&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#发起支付"><span class="toc-number">1.</span> <span class="toc-text">发起支付</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#微信小程序支付"><span class="toc-number">1.0.1.</span> <span class="toc-text">微信小程序支付</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#支付通知"><span class="toc-number">2.</span> <span class="toc-text">支付通知</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#支付查询"><span class="toc-number">3.</span> <span class="toc-text">支付查询</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#发起退款"><span class="toc-number">4.</span> <span class="toc-text">发起退款</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#退款通知"><span class="toc-number">5.</span> <span class="toc-text">退款通知</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#退款查询"><span class="toc-number">6.</span> <span class="toc-text">退款查询</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#关闭订单"><span class="toc-number">7.</span> <span class="toc-text">关闭订单</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#通用方法"><span class="toc-number">8.</span> <span class="toc-text">通用方法</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#将-Map-转换成为请求参数"><span class="toc-number">8.0.1.</span> <span class="toc-text">将 Map 转换成为请求参数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#计算签名"><span class="toc-number">8.0.2.</span> <span class="toc-text">计算签名</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#渠道擴展字段"><span class="toc-number">8.0.3.</span> <span class="toc-text">渠道擴展字段</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#响应数据"><span class="toc-number">9.</span> <span class="toc-text">响应数据</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#發起支付请求"><span class="toc-number">9.0.1.</span> <span class="toc-text">發起支付请求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#發起主動查詢"><span class="toc-number">9.0.2.</span> <span class="toc-text">發起主動查詢</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#商户异常"><span class="toc-number">10.</span> <span class="toc-text">商户异常</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#附：簽名測試接口"><span class="toc-number">11.</span> <span class="toc-text">附：簽名測試接口</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#附："><span class="toc-number">12.</span> <span class="toc-text">附：</span></a></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        聚合支付 Icbcmo
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">Hexo</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2021-04-27T00:00:56.000Z" itemprop="datePublished">2021-04-27</time>
        
        (Updated: <time datetime="2021-06-09T05:21:27.180Z" itemprop="dateModified">2021-06-09</time>)
        
      
    </div>


      
    <div class="article-category">
        <i class="fas fa-archive"></i>
        <a class="category-link" href="/categories/架构设计/">架构设计</a> › <a class="category-link" href="/categories/架构设计/支付开发/">支付开发</a>
    </div>


      

    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <p>公司官网：<a href="https://www.icbc.com.mo">https://www.icbc.com.mo</a><br>开发文档：<a href="https://app.icbcmo.site/gitbook">https://app.icbcmo.site/gitbook</a> Login name: ebyte Password: ebyte</p>
<p>工銀澳門聚合支付 Plus。</p>
<h2 id="发起支付"><a href="#发起支付" class="headerlink" title="发起支付"></a>发起支付</h2><h4 id="微信小程序支付"><a href="#微信小程序支付" class="headerlink" title="微信小程序支付"></a>微信小程序支付</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">order</span><span class="params">(Long orderId, String createIp)</span> </span>&#123;</span><br><span class="line">   <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="comment">// 1. 校验支付配置</span></span><br><span class="line">      icbcmoProperties.valid();</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 2. 查询订单数据</span></span><br><span class="line">      Order order = orderFeign.one(attr(Order::getMerchantId,</span><br><span class="line">                                          Order::getMemberId,</span><br><span class="line">                                          Order::getCode,</span><br><span class="line">                                          Order::getPayment),</span><br><span class="line">                                    id(orderId));</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 3. 查询用户OpenId</span></span><br><span class="line">      String openId = memberFeign.openId(order.getMemberId());</span><br><span class="line">      <span class="keyword">if</span> (StringUtils.isEmpty(openId)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> ServiceException(I18n2.warn_pay_1000001.locale());</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 4. 查询商户支付数据</span></span><br><span class="line">      IcbcmoPay icbcmoPay = merchantFeign.icbcmoPay(order.getMerchantId());</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 5. 支付金额</span></span><br><span class="line">      String amount = String.valueOf(order.getPayment().multiply(BigDecimal.valueOf(<span class="number">100</span>)).intValue());</span><br><span class="line"></span><br><span class="line">      TreeMap&lt;String, String&gt; params = <span class="keyword">new</span> TreeMap&lt;&gt;();</span><br><span class="line">      params.put(<span class="string">"merchantId"</span>, icbcmoPay.getMerchantId());            <span class="comment">// （必填）商戶號</span></span><br><span class="line">      params.put(<span class="string">"merchantTid"</span>, icbcmoPay.getMerchantTid());          <span class="comment">// （选填）商戶設備ID只適用於微信/支付寶</span></span><br><span class="line">      params.put(<span class="string">"channel"</span>, <span class="string">"WechatMiniApp"</span>);                         <span class="comment">// （必填）取值範圍請參考支付請求 channel 參數信息表</span></span><br><span class="line">      params.put(<span class="string">"merchantOrderId"</span>, order.getCode());                 <span class="comment">// （必填）商戶訂單ID</span></span><br><span class="line">      params.put(<span class="string">"merchantUserId"</span>, <span class="string">""</span>);                               <span class="comment">// （选填）商户的客户ID（仅线上POS使用）</span></span><br><span class="line">      params.put(<span class="string">"currency"</span>, <span class="string">"MOP"</span>);                                  <span class="comment">// （必填）貨幣（固定MOP）</span></span><br><span class="line">      params.put(<span class="string">"amount"</span>, amount);                                   <span class="comment">// （必填）額（分）</span></span><br><span class="line">      params.put(<span class="string">"timeout"</span>, <span class="string">"300"</span>);                                   <span class="comment">// （必填）超時時間（秒）（需要設置白名單才有效，該字段用來設置支付超時時間，沒有設置該值的情況，該值默認900秒，如果設置該值，選擇渠道為線上POS，超時支付之後系統會自動沖正退款）</span></span><br><span class="line">      params.put(<span class="string">"notifyUrl"</span>, icbcmoProperties.getNotifyurl());       <span class="comment">// （选填）通知支付接口</span></span><br><span class="line">      params.put(<span class="string">"returnUrl"</span>, icbcmoProperties.getReturnUrl());       <span class="comment">// （必填）前端回調接口</span></span><br><span class="line">      params.put(<span class="string">"channelExt"</span>, weixinChannelExt(icbcmoPay, openId));  <span class="comment">// （选填）渠道擴展字段, 必須為JSON格式</span></span><br><span class="line">      params.put(<span class="string">"merchantExt"</span>, <span class="string">""</span>);                                  <span class="comment">// （选填）商戶擴展字段該為保留字段, 無任何限制, 內容不會被處理</span></span><br><span class="line">      params.put(<span class="string">"sign"</span>, sign(icbcmoPay.getMd5Key(), params));        <span class="comment">// （必填）簽名用於校驗參數是否被篡改</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// 6. 转换成为请求参数 a=1&amp;b=2&amp;c=3&amp;sign=4</span></span><br><span class="line">      String queryStr = queryStr(params);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 7. 组装接口地址 https://app.icbcmo.site/api/v1/order?a=1&amp;b=2&amp;c=3&amp;sign=4</span></span><br><span class="line">      String request = icbcmoProperties.getUrl() + <span class="string">"/api/v1/order?"</span> + queryStr;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 8. 请求接口</span></span><br><span class="line">      log.info(<span class="string">"IcbcmoService.order Request: "</span> + request);</span><br><span class="line">      String response = Request.Post(request)</span><br><span class="line">                                 .addHeader(<span class="string">"Content-Type"</span>, <span class="string">"application/x-www-form-urlencoded"</span>)</span><br><span class="line">                                 .execute()</span><br><span class="line">                                 .returnContent().toString();</span><br><span class="line">      log.info(<span class="string">"IcbcmoService.order Response: "</span> + response);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 9. 结果处理  &#123;"code":"9998","retCode":"500","msg":"channel 請求參數不合法"&#125;</span></span><br><span class="line">      JSONObject responseJSON = JSONObject.parseObject(response);</span><br><span class="line">      <span class="keyword">if</span> (!responseJSON.getString(<span class="string">"retCode"</span>).equals(<span class="string">"200"</span>)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> ServiceException(responseJSON.getString(<span class="string">"msg"</span>));</span><br><span class="line">      &#125;</span><br><span class="line">   &#125; <span class="keyword">catch</span> (ServiceException e) &#123;</span><br><span class="line">      <span class="keyword">throw</span> e;</span><br><span class="line">   &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> ServiceException(BaseResultEnum.ERROR, e.getMessage(), e);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="支付通知"><a href="#支付通知" class="headerlink" title="支付通知"></a>支付通知</h2><h2 id="支付查询"><a href="#支付查询" class="headerlink" title="支付查询"></a>支付查询</h2><h2 id="发起退款"><a href="#发起退款" class="headerlink" title="发起退款"></a>发起退款</h2><h2 id="退款通知"><a href="#退款通知" class="headerlink" title="退款通知"></a>退款通知</h2><h2 id="退款查询"><a href="#退款查询" class="headerlink" title="退款查询"></a>退款查询</h2><h2 id="关闭订单"><a href="#关闭订单" class="headerlink" title="关闭订单"></a>关闭订单</h2><h2 id="通用方法"><a href="#通用方法" class="headerlink" title="通用方法"></a>通用方法</h2><h4 id="将-Map-转换成为请求参数"><a href="#将-Map-转换成为请求参数" class="headerlink" title="将 Map 转换成为请求参数"></a>将 Map 转换成为请求参数</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 将Map转换成为请求参数</span></span><br><span class="line"><span class="comment">* &#123;"a":1, "b": 2&#125; -&gt; a=2&amp;b=2</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> String <span class="title">queryStr</span><span class="params">(Map&lt;String, String&gt; signMap)</span> </span>&#123;</span><br><span class="line">   List&lt;String&gt; keys = <span class="keyword">new</span> ArrayList&lt;&gt;(signMap.keySet());</span><br><span class="line">   Collections.sort(keys);</span><br><span class="line"></span><br><span class="line">   StringBuilder sb = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">   <span class="keyword">for</span> (String key : keys) &#123;</span><br><span class="line">      String value = signMap.get(key);</span><br><span class="line">      <span class="keyword">if</span> (StringUtils.isEmpty(value)) <span class="keyword">continue</span>;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">            value = URLEncoder.encode(value, <span class="string">"utf-8"</span>);</span><br><span class="line">      &#125; <span class="keyword">catch</span> (UnsupportedEncodingException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">      &#125;</span><br><span class="line">      sb.append(key).append(<span class="string">"="</span>).append(value).append(<span class="string">"&amp;"</span>);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">if</span> (sb.length() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      sb.deleteCharAt(sb.length() - <span class="number">1</span>);</span><br><span class="line">   &#125;</span><br><span class="line">   System.out.println(<span class="string">"dataStr: "</span> + sb);</span><br><span class="line">   <span class="keyword">return</span> sb.toString();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="计算签名"><a href="#计算签名" class="headerlink" title="计算签名"></a>计算签名</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> String <span class="title">sign</span><span class="params">(String privateKey, Map&lt;String, String&gt; signMap)</span> </span>&#123;</span><br><span class="line">   String dataStr = queryStr(signMap);</span><br><span class="line">   <span class="keyword">return</span> Md5Utils.getMD5((dataStr + privateKey).getBytes());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="渠道擴展字段"><a href="#渠道擴展字段" class="headerlink" title="渠道擴展字段"></a>渠道擴展字段</h4><p>参考：<a href="https://app.icbcmo.site/gitbook/cn/chap4/chap4.4.2.html">https://app.icbcmo.site/gitbook/cn/chap4/chap4.4.2.html</a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 微信参数表</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> String <span class="title">weixinChannelExt</span><span class="params">(IcbcmoPay icbcmoPay, String openId)</span> </span>&#123;</span><br><span class="line">   <span class="keyword">if</span> (icbcmoPay == <span class="keyword">null</span> || icbcmoPay.getWeixinChannelExt() == <span class="keyword">null</span> || StringUtils.isEmpty(openId)) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> ServiceException(BaseResultEnum.ERROR, <span class="string">"数据异常"</span>);</span><br><span class="line">   &#125;</span><br><span class="line">   JSONObject params = <span class="keyword">new</span> JSONObject();</span><br><span class="line">   params.put(<span class="string">"body"</span>, <span class="string">""</span>);                                             <span class="comment">// 訂單購物明細，非必填。如不填入則系統自動填入商家簡稱。</span></span><br><span class="line">   params.put(<span class="string">"custom_display_code"</span>, <span class="string">""</span>);                              <span class="comment">// 是否商家自建支付頁面或使用系統支付頁面。商家自建支付頁面: Y系統支付頁面: N (默認)</span></span><br><span class="line">   params.put(<span class="string">"wx_appid"</span>, icbcmoPay.getWeixinChannelExt().getAppId()); <span class="comment">// 商戶在微信開放平臺註冊生成的appid。渠道為微信APP和微信小程序時必填。</span></span><br><span class="line">   params.put(<span class="string">"openid"</span>, openId);                                       <span class="comment">// 商戶在微信開放平臺註冊生成的appid。渠道為微信APP和微信小程序時必填。</span></span><br><span class="line">   <span class="keyword">return</span> params.toJSONString();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="响应数据"><a href="#响应数据" class="headerlink" title="响应数据"></a>响应数据</h2><h4 id="發起支付请求"><a href="#發起支付请求" class="headerlink" title="發起支付请求"></a>發起支付请求</h4><p><strong>1. 请求参数</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zhangqinghua$ curl https://app.icbcmo.site/api/v1/order?amount=7&amp;channel=WechatMiniApp&amp;channelExt=%7B%22custom_display_code%22%3A%22%22%2C%22wx_appid%22%3A%22wx47d7859ff4ec85c4%22%2C%22openid%22%3A%22ohGhc5MWsYW_zkB4j0C_zCDx93H0%22%2C%22body%22%3A%22%22%7D&amp;currency=MOP&amp;merchantId=011900000000002&amp;merchantOrderId=20210604155233849229&amp;merchantTid=00000011&amp;notifyUrl=https%3A%2F%2Fwww.baidu.com&amp;returnUrl=pages%2Findex%2Findex&amp;sign=722d3cfeae052f6d02bc1b0fa9af8648&amp;timeout=300</span><br></pre></td></tr></table></figure>
<p><strong>2. 异常响应</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"code"</span>: <span class="string">"1094"</span>, </span><br><span class="line">    <span class="attr">"retCode"</span>: <span class="string">"500"</span>, </span><br><span class="line">    <span class="attr">"msg"</span>: <span class="string">"訂單號重複, Duplicate order number"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"retCode"</span>: <span class="string">"200"</span>, </span><br><span class="line">    <span class="attr">"returnObj"</span>: &#123;</span><br><span class="line">        <span class="attr">"merchantId"</span>: <span class="string">"011999010002500"</span>, </span><br><span class="line">        <span class="attr">"merchantTid"</span>: <span class="string">"00000001"</span>, </span><br><span class="line">        <span class="attr">"channel"</span>: <span class="string">"WechatMiniApp"</span>, </span><br><span class="line">        <span class="attr">"merchantOrderId"</span>: <span class="string">"100000581"</span>, </span><br><span class="line">        <span class="attr">"icbcOrderId"</span>: <span class="string">"001WE20210602105446369294200"</span>, </span><br><span class="line">        <span class="attr">"currency"</span>: <span class="string">"MOP"</span>, </span><br><span class="line">        <span class="attr">"amount"</span>: <span class="string">"5"</span>, </span><br><span class="line">        <span class="attr">"respCode"</span>: <span class="string">"42"</span>, </span><br><span class="line">        <span class="attr">"respMsgDetail"</span>: <span class="string">"參數錯誤，請根據文檔上送參數[小程式尺幅需要填入參數openid]"</span></span><br><span class="line">    &#125;, </span><br><span class="line">    <span class="attr">"sign"</span>: <span class="string">"970360aa375bdebc7e7ab2dccc68b719"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"retCode"</span>: <span class="string">"200"</span>, </span><br><span class="line">    <span class="attr">"returnObj"</span>: &#123;</span><br><span class="line">        <span class="attr">"merchantId"</span>: <span class="string">"011999010002500"</span>, </span><br><span class="line">        <span class="attr">"merchantTid"</span>: <span class="string">"00000001"</span>, </span><br><span class="line">        <span class="attr">"channel"</span>: <span class="string">"WechatMiniApp"</span>, </span><br><span class="line">        <span class="attr">"merchantOrderId"</span>: <span class="string">"10000058182137"</span>, </span><br><span class="line">        <span class="attr">"icbcOrderId"</span>: <span class="string">"001WE20210602111424424911969"</span>, </span><br><span class="line">        <span class="attr">"currency"</span>: <span class="string">"MOP"</span>, </span><br><span class="line">        <span class="attr">"amount"</span>: <span class="string">"5"</span>, </span><br><span class="line">        <span class="attr">"respCode"</span>: <span class="string">"32"</span>, </span><br><span class="line">        <span class="attr">"respMsgDetail"</span>: <span class="string">"生成預付單失敗，請聯繫機構檢查"</span>, </span><br><span class="line">        <span class="attr">"wxErrCode"</span>: <span class="string">"FAIL"</span>, </span><br><span class="line">        <span class="attr">"wxErrCodeDesc"</span>: <span class="string">"sub_mch_id与sub_appid不匹配"</span></span><br><span class="line">    &#125;, </span><br><span class="line">    <span class="attr">"sign"</span>: <span class="string">"0477f49c3ab4645085c3455afce9c91e"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>3. 微信扫码支付响应</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">   <span class="attr">"retCode"</span>:<span class="string">"200"</span>,</span><br><span class="line">   <span class="attr">"returnObj"</span>:</span><br><span class="line">   &#123;</span><br><span class="line">      <span class="attr">"merchantId"</span>:<span class="string">"011901200001001"</span>,</span><br><span class="line">      <span class="attr">"merchantTid"</span>:<span class="string">"11"</span>,</span><br><span class="line">      <span class="attr">"channel"</span>:<span class="string">"WechatPayPC"</span>,</span><br><span class="line">      <span class="attr">"merchantOrderId"</span>:<span class="string">"ICBC_AIO_20190711_091944"</span>,</span><br><span class="line">      <span class="attr">"icbcOrderId"</span>:<span class="string">"011WE20190711091957823988639"</span>,</span><br><span class="line">      <span class="attr">"currency"</span>:<span class="string">"MOP"</span>,</span><br><span class="line">      <span class="attr">"amount"</span>:<span class="string">"100"</span>,</span><br><span class="line">      <span class="attr">"redirectUrl"</span>:<span class="string">"https://mobilepaytest.icbc.com.mo/api/payment/NativePayPage.aspx?orderno=90120000100100000011190711538371&amp;sign=3661b8d0975563e85dcc9df3ce94b065&amp;time=120"</span></span><br><span class="line">   &#125;,</span><br><span class="line">   <span class="attr">"sign"</span>:<span class="string">"c5a7ec6aa5c57eb6b4fa0aa41a2bb26a"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>4. 微信小程序支付响应</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"retCode"</span>: <span class="string">"200"</span>, </span><br><span class="line">    <span class="attr">"returnObj"</span>: &#123;</span><br><span class="line">        <span class="attr">"merchantId"</span>: <span class="string">"011900000000002"</span>, </span><br><span class="line">        <span class="attr">"merchantTid"</span>: <span class="string">"00000011"</span>, </span><br><span class="line">        <span class="attr">"channel"</span>: <span class="string">"WechatMiniApp"</span>, </span><br><span class="line">        <span class="attr">"merchantOrderId"</span>: <span class="string">"10000058160843"</span>, </span><br><span class="line">        <span class="attr">"icbcOrderId"</span>: <span class="string">"011WE20210603183143021474642"</span>, </span><br><span class="line">        <span class="attr">"currency"</span>: <span class="string">"MOP"</span>, </span><br><span class="line">        <span class="attr">"amount"</span>: <span class="string">"5"</span>, </span><br><span class="line">        <span class="attr">"respCode"</span>: <span class="string">"00"</span>, </span><br><span class="line">        <span class="attr">"respMsgDetail"</span>: <span class="string">"SUCCESS"</span>, </span><br><span class="line">        <span class="attr">"sign"</span>: <span class="string">"D1E5B79FF8569EFD5CF1BFF42481817C"</span>, </span><br><span class="line">        <span class="attr">"appId"</span>: <span class="string">"wx47d7859ff4ec85c4"</span>, </span><br><span class="line">        <span class="attr">"nonceStr"</span>: <span class="string">"BD686FD640BE98EFAAE0091FA301E613"</span>, </span><br><span class="line">        <span class="attr">"signType"</span>: <span class="string">"MD5"</span>, </span><br><span class="line">        <span class="attr">"timeStamp"</span>: <span class="string">"1622716302"</span>, </span><br><span class="line">        <span class="attr">"package"</span>: <span class="string">"prepay_id=wx031831441262294383aa020140228c0000"</span></span><br><span class="line">    &#125;, </span><br><span class="line">    <span class="attr">"sign"</span>: <span class="string">"2f553aa3ab9e44c516d8172cd5c720a8"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>5. POS 支付返回</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"retCode"</span>: <span class="string">"200"</span>, </span><br><span class="line">    <span class="attr">"returnObj"</span>: &#123;</span><br><span class="line">        <span class="attr">"merchantId"</span>: <span class="string">"011901200001005"</span>, </span><br><span class="line">        <span class="attr">"merchantTid"</span>: <span class="string">"00000001"</span>, </span><br><span class="line">        <span class="attr">"channel"</span>: <span class="string">"ICBCOnlinePosOrder"</span>, </span><br><span class="line">        <span class="attr">"merchantOrderId"</span>: <span class="string">"20210607112944860991"</span>, </span><br><span class="line">        <span class="attr">"icbcOrderId"</span>: <span class="string">"001IC20210607145051758855978"</span>, </span><br><span class="line">        <span class="attr">"currency"</span>: <span class="string">"MOP"</span>, </span><br><span class="line">        <span class="attr">"amount"</span>: <span class="string">"6"</span>, </span><br><span class="line">        <span class="attr">"redirectUrl"</span>: <span class="string">"https://ebankpfovaopay4.dccnet.com.cn/servletxxxxx"</span></span><br><span class="line">    &#125;, </span><br><span class="line">    <span class="attr">"sign"</span>: <span class="string">"7cc6461d3e6f92155f867790c4b40529"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="發起主動查詢"><a href="#發起主動查詢" class="headerlink" title="發起主動查詢"></a>發起主動查詢</h4><p><strong>1. 请求参数</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zhangqinghua$ curl https://app.icbcmo.site/api/v1/query?merchantId=011900000000002&amp;merchantOrderId=20210604155233849229&amp;sign=c5696f38c847aa0b53b9e105f04bf985</span><br></pre></td></tr></table></figure>
<p><strong>2. 异常响应</strong><br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"code"</span>: <span class="string">"1095"</span>, </span><br><span class="line">    <span class="attr">"retCode"</span>: <span class="string">"500"</span>, </span><br><span class="line">    <span class="attr">"msg"</span>: <span class="string">"查無此訂單，請核實, Check this order, please verify"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>3. 支付宝响应</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"retCode"</span>: <span class="string">"200"</span>,</span><br><span class="line">  <span class="attr">"returnObj"</span>: &#123;</span><br><span class="line">    <span class="attr">"merchantId"</span>: <span class="string">"011901200001001"</span>,</span><br><span class="line">    <span class="attr">"merchantTid"</span>: <span class="string">"00000011"</span>,</span><br><span class="line">    <span class="attr">"merchantOrderId"</span>: <span class="string">"ICBC_AIO_20190710_233100"</span>,</span><br><span class="line">    <span class="attr">"icbcOrderId"</span>: <span class="string">"011AL20190710233158379876488"</span>,</span><br><span class="line">    <span class="attr">"channelTransId"</span>: <span class="string">"2019071022001330371041428517"</span>,</span><br><span class="line">    <span class="attr">"orderStatus"</span>: <span class="string">"Success"</span>,</span><br><span class="line">    <span class="attr">"orderStatusDesc"</span>: <span class="string">"支付成功"</span>,</span><br><span class="line">    <span class="attr">"channel"</span>: <span class="string">"AlipayWEB"</span>,</span><br><span class="line">    <span class="attr">"orderCurrency"</span>: <span class="string">"MOP"</span>,</span><br><span class="line">    <span class="attr">"orderAmount"</span>: <span class="string">"5"</span>,</span><br><span class="line">    <span class="attr">"cashCurrency"</span>: <span class="string">"CNY"</span>,</span><br><span class="line">    <span class="attr">"cashAmount"</span>: <span class="string">"4"</span>,</span><br><span class="line">    <span class="attr">"bankType"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="attr">"tradeTime"</span>: <span class="string">"2019-07-10 23:32:21"</span>,</span><br><span class="line">    <span class="attr">"errorCode"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="attr">"errorMessage"</span>: <span class="string">""</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"sign"</span>: <span class="string">"4e349f7fa5ec47f5321ab967edc6bc8c"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>4. 微信支付响应</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"retCode"</span>: <span class="string">"200"</span>, </span><br><span class="line">    <span class="attr">"returnObj"</span>: &#123;</span><br><span class="line">        <span class="attr">"merchantId"</span>: <span class="string">"011900000000002"</span>, </span><br><span class="line">        <span class="attr">"merchantTid"</span>: <span class="string">"00000011"</span>, </span><br><span class="line">        <span class="attr">"merchantOrderId"</span>: <span class="string">"20210607103609472187"</span>, </span><br><span class="line">        <span class="attr">"icbcOrderId"</span>: <span class="string">"011WE20210607103617064565574"</span>, </span><br><span class="line">        <span class="attr">"channelTransId"</span>: <span class="string">"4200001030202106070520800740"</span>, </span><br><span class="line">        <span class="attr">"customer_user_id"</span>: <span class="string">""</span>, </span><br><span class="line">        <span class="attr">"orderStatus"</span>: <span class="string">"Success"</span>, </span><br><span class="line">        <span class="attr">"orderStatusDesc"</span>: <span class="string">"支付成功"</span>, </span><br><span class="line">        <span class="attr">"channel"</span>: <span class="string">"WechatMiniApp"</span>, </span><br><span class="line">        <span class="attr">"orderCurrency"</span>: <span class="string">"MOP"</span>, </span><br><span class="line">        <span class="attr">"orderAmount"</span>: <span class="string">"6"</span>, </span><br><span class="line">        <span class="attr">"discountAmount"</span>: <span class="string">"0"</span>, </span><br><span class="line">        <span class="attr">"cashCurrency"</span>: <span class="string">"CNY"</span>, </span><br><span class="line">        <span class="attr">"cashAmount"</span>: <span class="string">"4"</span>, </span><br><span class="line">        <span class="attr">"bankType"</span>: <span class="string">"PAB_CREDIT"</span>, </span><br><span class="line">        <span class="attr">"receipt_amount"</span>: <span class="string">""</span>, </span><br><span class="line">        <span class="attr">"tradeTime"</span>: <span class="string">"2021-06-07 10:37:18"</span>, </span><br><span class="line">        <span class="attr">"errorCode"</span>: <span class="string">""</span>, </span><br><span class="line">        <span class="attr">"errorMessage"</span>: <span class="string">""</span>, </span><br><span class="line">        <span class="attr">"cardNo"</span>: <span class="string">""</span>, </span><br><span class="line">        <span class="attr">"cardType"</span>: <span class="string">""</span></span><br><span class="line">    &#125;, </span><br><span class="line">    <span class="attr">"sign"</span>: <span class="string">"e8080adfff9d1aeaec416948abf299fa"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>5. POS 支付响应</strong></p>
<h2 id="商户异常"><a href="#商户异常" class="headerlink" title="商户异常"></a>商户异常</h2><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"code"</span>: <span class="string">"9998"</span>, </span><br><span class="line">    <span class="attr">"retCode"</span>: <span class="string">"500"</span>, </span><br><span class="line">    <span class="attr">"msg"</span>: <span class="string">"channel 請求參數不合法"</span></span><br><span class="line">&#125;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"code"</span>: <span class="string">"1091"</span>, </span><br><span class="line">    <span class="attr">"retCode"</span>: <span class="string">"500"</span>, </span><br><span class="line">    <span class="attr">"msg"</span>: <span class="string">"簽名信息有誤, Signature information is incorrect"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"code"</span>: <span class="string">"1125"</span>, </span><br><span class="line">    <span class="attr">"retCode"</span>: <span class="string">"500"</span>, </span><br><span class="line">    <span class="attr">"msg"</span>: <span class="string">"獲取商戶信息出現異常. query merchant is abnormal"</span></span><br><span class="line">&#125;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"code"</span>: <span class="string">"9999"</span>, </span><br><span class="line">    <span class="attr">"retCode"</span>: <span class="string">"400"</span>, </span><br><span class="line">    <span class="attr">"msg"</span>: <span class="string">"系統後台異常！, System background exception!"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="附：簽名測試接口"><a href="#附：簽名測試接口" class="headerlink" title="附：簽名測試接口"></a>附：簽名測試接口</h2><p>参考：<a href="https://app.icbcmo.site/gitbook/cn/chap13/chap13.html">https://app.icbcmo.site/gitbook/cn/chap13/chap13.html</a></p>
<p>該測試接口用於測試下單參數的簽名結果，把所有下單參數（排除 sign 字段）post 到這個接口，即會返回參與簽名的內容（已隱藏signKey）及簽名結果，用於商戶自行校驗簽名方法及排查簽名錯誤原因。</p>
<p>請求URL: /api/v1/test/sign 請求方式: POST</p>
<p><img src="https://cdn.jsdelivr.net/gh/zhangqinghua/hexo_image/20210608180002.png" alt=""></p>
<h2 id="附："><a href="#附：" class="headerlink" title="附："></a>附：</h2>
  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Articles</a></li>
         
          <li><a href="/categories/">Categories</a></li>
         
          <li><a href="/search/">Search</a></li>
         
          <li><a href="/about/">About</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#发起支付"><span class="toc-number">1.</span> <span class="toc-text">发起支付</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#微信小程序支付"><span class="toc-number">1.0.1.</span> <span class="toc-text">微信小程序支付</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#支付通知"><span class="toc-number">2.</span> <span class="toc-text">支付通知</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#支付查询"><span class="toc-number">3.</span> <span class="toc-text">支付查询</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#发起退款"><span class="toc-number">4.</span> <span class="toc-text">发起退款</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#退款通知"><span class="toc-number">5.</span> <span class="toc-text">退款通知</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#退款查询"><span class="toc-number">6.</span> <span class="toc-text">退款查询</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#关闭订单"><span class="toc-number">7.</span> <span class="toc-text">关闭订单</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#通用方法"><span class="toc-number">8.</span> <span class="toc-text">通用方法</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#将-Map-转换成为请求参数"><span class="toc-number">8.0.1.</span> <span class="toc-text">将 Map 转换成为请求参数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#计算签名"><span class="toc-number">8.0.2.</span> <span class="toc-text">计算签名</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#渠道擴展字段"><span class="toc-number">8.0.3.</span> <span class="toc-text">渠道擴展字段</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#响应数据"><span class="toc-number">9.</span> <span class="toc-text">响应数据</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#發起支付请求"><span class="toc-number">9.0.1.</span> <span class="toc-text">發起支付请求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#發起主動查詢"><span class="toc-number">9.0.2.</span> <span class="toc-text">發起主動查詢</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#商户异常"><span class="toc-number">10.</span> <span class="toc-text">商户异常</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#附：簽名測試接口"><span class="toc-number">11.</span> <span class="toc-text">附：簽名測試接口</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#附："><span class="toc-number">12.</span> <span class="toc-text">附：</span></a></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://yoursite.com/2021/04/27/架构设计/支付开发/聚合支付 Icbcmo/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://yoursite.com/2021/04/27/架构设计/支付开发/聚合支付 Icbcmo/&text=聚合支付 Icbcmo"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://yoursite.com/2021/04/27/架构设计/支付开发/聚合支付 Icbcmo/&title=聚合支付 Icbcmo"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://yoursite.com/2021/04/27/架构设计/支付开发/聚合支付 Icbcmo/&is_video=false&description=聚合支付 Icbcmo"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=聚合支付 Icbcmo&body=Check out this article: http://yoursite.com/2021/04/27/架构设计/支付开发/聚合支付 Icbcmo/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://yoursite.com/2021/04/27/架构设计/支付开发/聚合支付 Icbcmo/&title=聚合支付 Icbcmo"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://yoursite.com/2021/04/27/架构设计/支付开发/聚合支付 Icbcmo/&title=聚合支付 Icbcmo"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://yoursite.com/2021/04/27/架构设计/支付开发/聚合支付 Icbcmo/&title=聚合支付 Icbcmo"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://yoursite.com/2021/04/27/架构设计/支付开发/聚合支付 Icbcmo/&title=聚合支付 Icbcmo"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://yoursite.com/2021/04/27/架构设计/支付开发/聚合支付 Icbcmo/&name=聚合支付 Icbcmo&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy; 2021 John Doe
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        
        <li><a href="/">Home</a></li>
        
        <li><a href="/archives/">Articles</a></li>
        
        <li><a href="/categories/">Categories</a></li>
        
        <li><a href="/search/">Search</a></li>
        
        <li><a href="/about/">About</a></li>
        
      </ul>
    </nav>
  </div>
</footer>


<!-- 根据页面mathjax变量决定是否加载MathJax数学公式js -->

    </div>
    <!-- styles -->
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
<link rel="stylesheet" href="/lib/justified-gallery/css/justifiedGallery.min.css">

    <!-- jquery -->
<script src="/lib/jquery/jquery.min.js"></script>
<script src="/lib/justified-gallery/js/jquery.justifiedGallery.min.js"></script>
<!-- clipboard -->

  <script src="/lib/clipboard/clipboard.min.js"></script>
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight .code pre").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      target: function(trigger) {
        return trigger.nextElementSibling;
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>

<script src="/js/main.js"></script>
<!-- search -->

<!-- Google Analytics -->

<!-- Baidu Analytics -->

<!-- Disqus Comments -->


</body>
</html>
