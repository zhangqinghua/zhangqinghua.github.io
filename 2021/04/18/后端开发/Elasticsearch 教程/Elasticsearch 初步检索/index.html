<!DOCTYPE html>
<html lang=en>
<head><meta name="generator" content="Hexo 3.9.0">
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="description" content="_cat查看 ES 健康信息12$ curl http://localhost:9200/_cat/health1618762998 16:23:18 docker-cluster green 1 1 3 3 0 0 0 0 - 100.0% 查看节点信息12$ curl http://localhost:9200/_cat/nodes  172.17.0.5 66 96 1 0.12 0.03">
<meta property="og:type" content="article">
<meta property="og:title" content="Elasticsearch 初步检索">
<meta property="og:url" content="http://yoursite.com/2021/04/18/后端开发/Elasticsearch 教程/Elasticsearch 初步检索/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="_cat查看 ES 健康信息12$ curl http://localhost:9200/_cat/health1618762998 16:23:18 docker-cluster green 1 1 3 3 0 0 0 0 - 100.0% 查看节点信息12$ curl http://localhost:9200/_cat/nodes  172.17.0.5 66 96 1 0.12 0.03">
<meta property="og:locale" content="en">
<meta property="og:updated_time" content="2021-06-17T09:26:05.977Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Elasticsearch 初步检索">
<meta name="twitter:description" content="_cat查看 ES 健康信息12$ curl http://localhost:9200/_cat/health1618762998 16:23:18 docker-cluster green 1 1 3 3 0 0 0 0 - 100.0% 查看节点信息12$ curl http://localhost:9200/_cat/nodes  172.17.0.5 66 96 1 0.12 0.03">
    
    
        
          
              <link rel="shortcut icon" href="/images/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
          
        
    
    <!-- title -->
    <title>Elasticsearch 初步检索</title>
    <!-- styles -->
    <link rel="stylesheet" href="/css/style.css">
    <!-- persian styles -->
    
      <link rel="stylesheet" href="/css/rtl.css">
    
    <!-- rss -->
    
    
</head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Articles</a></li>
         
          <li><a href="/categories/">Categories</a></li>
         
          <li><a href="/search/">Search</a></li>
         
          <li><a href="/about/">About</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/2021/04/18/后端开发/Elasticsearch 教程/Elasticsearch 安装/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" href="/2021/04/18/后端开发/Elasticsearch 教程/Elasticsearch 进阶检索/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://yoursite.com/2021/04/18/后端开发/Elasticsearch 教程/Elasticsearch 初步检索/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://yoursite.com/2021/04/18/后端开发/Elasticsearch 教程/Elasticsearch 初步检索/&text=Elasticsearch 初步检索"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://yoursite.com/2021/04/18/后端开发/Elasticsearch 教程/Elasticsearch 初步检索/&title=Elasticsearch 初步检索"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://yoursite.com/2021/04/18/后端开发/Elasticsearch 教程/Elasticsearch 初步检索/&is_video=false&description=Elasticsearch 初步检索"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Elasticsearch 初步检索&body=Check out this article: http://yoursite.com/2021/04/18/后端开发/Elasticsearch 教程/Elasticsearch 初步检索/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://yoursite.com/2021/04/18/后端开发/Elasticsearch 教程/Elasticsearch 初步检索/&title=Elasticsearch 初步检索"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://yoursite.com/2021/04/18/后端开发/Elasticsearch 教程/Elasticsearch 初步检索/&title=Elasticsearch 初步检索"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://yoursite.com/2021/04/18/后端开发/Elasticsearch 教程/Elasticsearch 初步检索/&title=Elasticsearch 初步检索"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://yoursite.com/2021/04/18/后端开发/Elasticsearch 教程/Elasticsearch 初步检索/&title=Elasticsearch 初步检索"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://yoursite.com/2021/04/18/后端开发/Elasticsearch 教程/Elasticsearch 初步检索/&name=Elasticsearch 初步检索&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#cat"><span class="toc-number">1.</span> <span class="toc-text">_cat</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#查看-ES-健康信息"><span class="toc-number">1.0.1.</span> <span class="toc-text">查看 ES 健康信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#查看节点信息"><span class="toc-number">1.0.2.</span> <span class="toc-text">查看节点信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#查看主节点"><span class="toc-number">1.0.3.</span> <span class="toc-text">查看主节点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#查看所有索引"><span class="toc-number">1.0.4.</span> <span class="toc-text">查看所有索引</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#保存文档"><span class="toc-number">2.</span> <span class="toc-text">保存文档</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#POST-保存"><span class="toc-number">2.0.1.</span> <span class="toc-text">POST 保存</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#PUT-保存"><span class="toc-number">2.0.2.</span> <span class="toc-text">PUT  保存</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#查询文档"><span class="toc-number">3.</span> <span class="toc-text">查询文档</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#更新文档"><span class="toc-number">4.</span> <span class="toc-text">更新文档</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#删除文档"><span class="toc-number">5.</span> <span class="toc-text">删除文档</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#批量-API"><span class="toc-number">6.</span> <span class="toc-text">批量 API</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#批量新增"><span class="toc-number">6.0.1.</span> <span class="toc-text">批量新增</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#批量修改"><span class="toc-number">6.0.2.</span> <span class="toc-text">批量修改</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#批量删除"><span class="toc-number">6.0.3.</span> <span class="toc-text">批量删除</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#混合操作"><span class="toc-number">6.0.4.</span> <span class="toc-text">混合操作</span></a></li></ol></li></ol></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        Elasticsearch 初步检索
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">Hexo</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2021-04-18T01:38:39.000Z" itemprop="datePublished">2021-04-18</time>
        
        (Updated: <time datetime="2021-06-17T09:26:05.977Z" itemprop="dateModified">2021-06-17</time>)
        
      
    </div>


      
    <div class="article-category">
        <i class="fas fa-archive"></i>
        <a class="category-link" href="/categories/后端开发/">后端开发</a> › <a class="category-link" href="/categories/后端开发/Elasticsearch-教程/">Elasticsearch 教程</a>
    </div>


      

    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <h2 id="cat"><a href="#cat" class="headerlink" title="_cat"></a>_cat</h2><h4 id="查看-ES-健康信息"><a href="#查看-ES-健康信息" class="headerlink" title="查看 ES 健康信息"></a>查看 ES 健康信息</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ curl http://localhost:9200/_cat/health</span><br><span class="line">1618762998 16:23:18 docker-cluster green 1 1 3 3 0 0 0 0 - 100.0%</span><br></pre></td></tr></table></figure>
<h4 id="查看节点信息"><a href="#查看节点信息" class="headerlink" title="查看节点信息"></a>查看节点信息</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ curl http://localhost:9200/_cat/nodes  </span><br><span class="line">172.17.0.5 66 96 1 0.12 0.03 0.01 dilm * 28e6018cc390</span><br></pre></td></tr></table></figure>
<h4 id="查看主节点"><a href="#查看主节点" class="headerlink" title="查看主节点"></a>查看主节点</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ curl http://localhost:9200/_cat/master</span><br><span class="line">iqIV_kIATDiLy46oUu-U7w 172.17.0.5 172.17.0.5 28e6018cc390</span><br></pre></td></tr></table></figure>
<h4 id="查看所有索引"><a href="#查看所有索引" class="headerlink" title="查看所有索引"></a>查看所有索引</h4><p>使用 <code>_cat/indices</code> 查询所有索引，类似 MySQL 的 <code>show databases;</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ curl http://localhost:9200/_cat/indices</span><br><span class="line">green open .kibana_task_manager_1   z_w2e978RwyfHT8yffAraQ 1 0 2 0 38.2kb 38.2kb</span><br><span class="line">green open .apm-agent-configuration EgVoY1rRQ8e0aIEPRmri-w 1 0 0 0   283b   283b</span><br><span class="line">green open .kibana_1                ZvfrNF4PQGKmCuE8Hl86sA 1 0 8 4 16.5kb 16.5kb</span><br></pre></td></tr></table></figure>
<h2 id="保存文档"><a href="#保存文档" class="headerlink" title="保存文档"></a>保存文档</h2><p>保存一个数据，保存在哪个索引的哪个类型下，指定用哪个唯一标识。</p>
<h4 id="POST-保存"><a href="#POST-保存" class="headerlink" title="POST 保存"></a>POST 保存</h4><p>POST 新增，如果不指定 id，会自动生成id。指定 id 则会修改这个数据，并新增版本号。</p>
<ol>
<li>不带 Id，新增操作；</li>
<li>带 Id，且存在此 Id，修改操作；</li>
<li>带 Id，且不存在此 Id，新增操作；</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ POST http://localhost:9200/customer/external</span><br><span class="line">&#123;</span><br><span class="line">	<span class="string">"name"</span>:<span class="string">"John Doe"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>响应数据：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	"_index": "customer",            # 对应 MySQL 的数据库   </span><br><span class="line">	"_type": "external",             # 对应 MySQL 的数据表</span><br><span class="line">	"_id": "nQW3G3kBh2g-jSNW1mPf",   # 对应 MySQL 的记录，自动生成的 Id</span><br><span class="line">	"_version": 1,                   # 版本号是1</span><br><span class="line">	"result": "created",             # 是保存操作</span><br><span class="line">	"_shards": &#123;</span><br><span class="line">		"total": 2,</span><br><span class="line">		"successful": 1,</span><br><span class="line">		"failed": 0</span><br><span class="line">	&#125;,</span><br><span class="line">	"_seq_no": 2,</span><br><span class="line">	"_primary_term": 1</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>多次发送此请求，均是 created 操作。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="attr">"_index"</span>: <span class="string">"customer"</span>,</span><br><span class="line">	<span class="attr">"_type"</span>: <span class="string">"external"</span>,</span><br><span class="line">	"_id": "ngW6G3kBh2g-jSNWY2NB",  # 第二次发送此请求，Id 变了，表示是一个新的数据</span><br><span class="line">	"_version": 1,</span><br><span class="line">	"result": "created",</span><br><span class="line">	"_shards": &#123;</span><br><span class="line">		"total": 2,</span><br><span class="line">		"successful": 1,</span><br><span class="line">		"failed": 0</span><br><span class="line">	&#125;,</span><br><span class="line">	"_seq_no": 3,</span><br><span class="line">	"_primary_term": 1</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果带上 Id，此 Id 不存在，则是新增操作，此 Id 存在，则是 updated 操作。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ POST http://localhost:9200/customer/external/ngW6G3kBh2g-jSNWY2NB</span><br><span class="line">&#123;</span><br><span class="line">	<span class="string">"name"</span>:<span class="string">"John Doe"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>响应数据：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="attr">"_index"</span>: <span class="string">"customer"</span>,</span><br><span class="line">	<span class="attr">"_type"</span>: <span class="string">"external"</span>,</span><br><span class="line">	<span class="attr">"_id"</span>: <span class="string">"ngW6G3kBh2g-jSNWY2NB"</span>,</span><br><span class="line">	<span class="attr">"_version"</span>: <span class="number">2</span>,</span><br><span class="line">	<span class="attr">"result"</span>: <span class="string">"updated"</span>,</span><br><span class="line">	<span class="attr">"_shards"</span>: &#123;</span><br><span class="line">		<span class="attr">"total"</span>: <span class="number">2</span>,</span><br><span class="line">		<span class="attr">"successful"</span>: <span class="number">1</span>,</span><br><span class="line">		<span class="attr">"failed"</span>: <span class="number">0</span></span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="attr">"_seq_no"</span>: <span class="number">4</span>,</span><br><span class="line">	<span class="attr">"_primary_term"</span>: <span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="PUT-保存"><a href="#PUT-保存" class="headerlink" title="PUT  保存"></a>PUT  保存</h4><p>第一次发送，是新增操作，后续请求，是更新操作。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 对应 MySQL 的数据库、表、记录。</span></span><br><span class="line">$ PUT http://localhost:9200/customer/external/1</span><br><span class="line">&#123;</span><br><span class="line">	<span class="string">"name"</span>:<span class="string">"John Doe"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>响应的元数据：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="attr">"_index"</span>: <span class="string">"customer"</span>,</span><br><span class="line">	<span class="attr">"_type"</span>: <span class="string">"external"</span>,</span><br><span class="line">	<span class="attr">"_id"</span>: <span class="string">"1"</span>,</span><br><span class="line">	"_version": 1,       # 版本号，第一次操作，版本号是1</span><br><span class="line">	"result": "created", # 操作类型，第一次操作，是保存，后面的操作，是更新</span><br><span class="line">	"_shards": &#123;         # 分片信息</span><br><span class="line">		"total": 2,</span><br><span class="line">		"successful": 1,</span><br><span class="line">		"failed": 0</span><br><span class="line">	&#125;,</span><br><span class="line">	"_seq_no": 0,</span><br><span class="line">	"_primary_term": 1</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>第二次发送响应：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="attr">"_index"</span>: <span class="string">"customer"</span>,</span><br><span class="line">	<span class="attr">"_type"</span>: <span class="string">"external"</span>,</span><br><span class="line">	<span class="attr">"_id"</span>: <span class="string">"1"</span>,</span><br><span class="line">	"_version": 2,       # 第二次操作，版本号变成2</span><br><span class="line">	"result": "updated", # 第二次操作，变成更新</span><br><span class="line">	"_shards": &#123;</span><br><span class="line">		"total": 2,</span><br><span class="line">		"successful": 1,</span><br><span class="line">		"failed": 0</span><br><span class="line">	&#125;,</span><br><span class="line">	"_seq_no": 1,</span><br><span class="line">	"_primary_term": 1</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>PUT 操作必须带 Id，这是跟 POST 最大的区别。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ PUT http://localhost:9200/customer/external</span><br><span class="line">&#123;</span><br><span class="line">	<span class="string">"name"</span>:<span class="string">"John Doe"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>响应数据：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="attr">"error"</span>: <span class="string">"Incorrect HTTP method for uri [/customer/external] and method [PUT], allowed: [POST]"</span>,</span><br><span class="line">	<span class="attr">"status"</span>: <span class="number">405</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="查询文档"><a href="#查询文档" class="headerlink" title="查询文档"></a>查询文档</h2><p>Elasticsearch 使用 GET 请求来查询文档。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ GET http://localhost:9200/customer/external/1</span><br></pre></td></tr></table></figure>
<p>响应数据：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="attr">"_index"</span>: <span class="string">"customer"</span>,</span><br><span class="line">	<span class="attr">"_type"</span>: <span class="string">"external"</span>,</span><br><span class="line">	<span class="attr">"_id"</span>: <span class="string">"1"</span>,</span><br><span class="line">	<span class="attr">"_version"</span>: <span class="number">2</span>,</span><br><span class="line">	"_seq_no": 1,        # 并发控制字段，每次更新就会 +1，用来做乐观锁</span><br><span class="line">	"_primary_term": 1,  # 同上，主分片重新分配。如重启，就会变化</span><br><span class="line">	"found": true,       # 是否找到了数据</span><br><span class="line">	"_source": &#123;         # 数据的内容</span><br><span class="line">		"name": "John Doe"</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>_seq_no</code> 和 <code>_primary_term</code> 可以用来做并发更新操作，假设我们有 2 个线程要对这条数据进行修改操作。</p>
<p>线程一进行修改：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ PUT http://localhost:9200/customer/external/1?if_seq_no=1&amp;if__primary_term=1</span><br><span class="line">&#123;</span><br><span class="line">	<span class="string">"name"</span>:<span class="string">"John Doe"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>响应数据：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="attr">"_index"</span>: <span class="string">"customer"</span>,</span><br><span class="line">	<span class="attr">"_type"</span>: <span class="string">"external"</span>,</span><br><span class="line">	<span class="attr">"_id"</span>: <span class="string">"1"</span>,</span><br><span class="line">	<span class="attr">"_version"</span>: <span class="number">4</span>,</span><br><span class="line">	<span class="attr">"result"</span>: <span class="string">"updated"</span>,</span><br><span class="line">	<span class="attr">"_shards"</span>: &#123;</span><br><span class="line">		<span class="attr">"total"</span>: <span class="number">2</span>,</span><br><span class="line">		<span class="attr">"successful"</span>: <span class="number">1</span>,</span><br><span class="line">		<span class="attr">"failed"</span>: <span class="number">0</span></span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="attr">"_seq_no"</span>: <span class="number">9</span>,</span><br><span class="line">	<span class="attr">"_primary_term"</span>: <span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>此时 <code>_seq_no</code> 和 <code>_primary_term</code> 已经变更了，如果线程二还是持有旧的数据，则会修改失败：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ PUT http://localhost:9200/customer/external/1?if_seq_no=1&amp;if__primary_term=1</span><br><span class="line">&#123;</span><br><span class="line">	<span class="string">"name"</span>:<span class="string">"John Doe"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>响应数据：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="attr">"error"</span>: &#123;</span><br><span class="line">		<span class="attr">"root_cause"</span>: [</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="attr">"type"</span>: <span class="string">"version_conflict_engine_exception"</span>,</span><br><span class="line">				<span class="attr">"reason"</span>: <span class="string">"[1]: version conflict, required seqNo [8], primary term [1]. current document has seqNo [9] and primary term [1]"</span>,</span><br><span class="line">				<span class="attr">"index_uuid"</span>: <span class="string">"2dqEzaASRGWaJBIpVgMqvg"</span>,</span><br><span class="line">				<span class="attr">"shard"</span>: <span class="string">"0"</span>,</span><br><span class="line">				<span class="attr">"index"</span>: <span class="string">"customer"</span></span><br><span class="line">			&#125;</span><br><span class="line">		],</span><br><span class="line">		<span class="attr">"type"</span>: <span class="string">"version_conflict_engine_exception"</span>,</span><br><span class="line">		<span class="attr">"reason"</span>: <span class="string">"[1]: version conflict, required seqNo [8], primary term [1]. current document has seqNo [9] and primary term [1]"</span>,</span><br><span class="line">		<span class="attr">"index_uuid"</span>: <span class="string">"2dqEzaASRGWaJBIpVgMqvg"</span>,</span><br><span class="line">		<span class="attr">"shard"</span>: <span class="string">"0"</span>,</span><br><span class="line">		<span class="attr">"index"</span>: <span class="string">"customer"</span></span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="attr">"status"</span>: <span class="number">409</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>此时线程二只能重新查询一次数据，然后再更新，跟 CAS 相似。</p>
<h2 id="更新文档"><a href="#更新文档" class="headerlink" title="更新文档"></a>更新文档</h2><p>前面的 POST 和 PUT 均可以新增和更新文档。但是如果我们希望明确的指定更新文档，则可以使用 _update 请求。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ POST http://localhost:9200/customer/external/1/_update</span><br><span class="line">&#123;</span><br><span class="line">   <span class="string">"doc"</span>: &#123;             <span class="comment"># 嵌套的 doc 属性</span></span><br><span class="line">      <span class="string">"name"</span>:<span class="string">"John Doe"</span></span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>响应数据：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="attr">"_index"</span>: <span class="string">"customer"</span>,</span><br><span class="line">	<span class="attr">"_type"</span>: <span class="string">"external"</span>,</span><br><span class="line">	<span class="attr">"_id"</span>: <span class="string">"1"</span>,</span><br><span class="line">	<span class="attr">"_version"</span>: <span class="number">4</span>,</span><br><span class="line">	<span class="attr">"result"</span>: <span class="string">"noop"</span>,</span><br><span class="line">	<span class="attr">"_shards"</span>: &#123;</span><br><span class="line">		<span class="attr">"total"</span>: <span class="number">0</span>,</span><br><span class="line">		<span class="attr">"successful"</span>: <span class="number">0</span>,</span><br><span class="line">		<span class="attr">"failed"</span>: <span class="number">0</span></span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="attr">"_seq_no"</span>: <span class="number">9</span>,</span><br><span class="line">	<span class="attr">"_primary_term"</span>: <span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>重复请求，则返回成功，但是没有更新：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="attr">"_index"</span>: <span class="string">"customer"</span>,</span><br><span class="line">	<span class="attr">"_type"</span>: <span class="string">"external"</span>,</span><br><span class="line">	<span class="attr">"_id"</span>: <span class="string">"1"</span>,</span><br><span class="line">	"_version": 4,          # 不变</span><br><span class="line">	"result": "noop",       # 表示没有操作</span><br><span class="line">	"_shards": &#123;</span><br><span class="line">		"total": 0,</span><br><span class="line">		"successful": 0,</span><br><span class="line">		"failed": 0</span><br><span class="line">	&#125;,</span><br><span class="line">	"_seq_no": 9,           # 不变</span><br><span class="line">	"_primary_term": 1      # 不变</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>_update</code> 请求必须嵌套一层 doc 属性。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ POST http://localhost:9200/customer/external/1/_update</span><br><span class="line">&#123;</span><br><span class="line">	<span class="string">"name"</span>:<span class="string">"John Doe"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>响应数据：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="attr">"error"</span>: &#123;</span><br><span class="line">		<span class="attr">"root_cause"</span>: [</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="attr">"type"</span>: <span class="string">"version_conflict_engine_exception"</span>,</span><br><span class="line">				<span class="attr">"reason"</span>: <span class="string">"[1]: version conflict, required seqNo [8], primary term [1]. current document has seqNo [9] and primary term [1]"</span>,</span><br><span class="line">				<span class="attr">"index_uuid"</span>: <span class="string">"2dqEzaASRGWaJBIpVgMqvg"</span>,</span><br><span class="line">				<span class="attr">"shard"</span>: <span class="string">"0"</span>,</span><br><span class="line">				<span class="attr">"index"</span>: <span class="string">"customer"</span></span><br><span class="line">			&#125;</span><br><span class="line">		],</span><br><span class="line">		<span class="attr">"type"</span>: <span class="string">"version_conflict_engine_exception"</span>,</span><br><span class="line">		<span class="attr">"reason"</span>: <span class="string">"[1]: version conflict, required seqNo [8], primary term [1]. current document has seqNo [9] and primary term [1]"</span>,</span><br><span class="line">		<span class="attr">"index_uuid"</span>: <span class="string">"2dqEzaASRGWaJBIpVgMqvg"</span>,</span><br><span class="line">		<span class="attr">"shard"</span>: <span class="string">"0"</span>,</span><br><span class="line">		<span class="attr">"index"</span>: <span class="string">"customer"</span></span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="attr">"status"</span>: <span class="number">409</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="删除文档"><a href="#删除文档" class="headerlink" title="删除文档"></a>删除文档</h2><p>DELETE 请求用来删除文档。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ DELETE http://localhost:9200/customer/external/1</span><br></pre></td></tr></table></figure>
<p>响应数据：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="attr">"_index"</span>: <span class="string">"customer"</span>,</span><br><span class="line">	<span class="attr">"_type"</span>: <span class="string">"external"</span>,</span><br><span class="line">	<span class="attr">"_id"</span>: <span class="string">"1"</span>,</span><br><span class="line">	<span class="attr">"_version"</span>: <span class="number">5</span>,</span><br><span class="line">	<span class="attr">"result"</span>: <span class="string">"deleted"</span>,</span><br><span class="line">	<span class="attr">"_shards"</span>: &#123;</span><br><span class="line">		<span class="attr">"total"</span>: <span class="number">2</span>,</span><br><span class="line">		<span class="attr">"successful"</span>: <span class="number">1</span>,</span><br><span class="line">		<span class="attr">"failed"</span>: <span class="number">0</span></span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="attr">"_seq_no"</span>: <span class="number">10</span>,</span><br><span class="line">	<span class="attr">"_primary_term"</span>: <span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>再次查找，提示数据不存在：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ GET http://localhost:9200/customer/external/1</span><br><span class="line">&#123;</span><br><span class="line">	<span class="string">"_index"</span>: <span class="string">"customer"</span>,</span><br><span class="line">	<span class="string">"_type"</span>: <span class="string">"external"</span>,</span><br><span class="line">	<span class="string">"_id"</span>: <span class="string">"1"</span>,</span><br><span class="line">	<span class="string">"found"</span>: <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们可以可以来删除整个索引：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查询所有索引，存在 customer</span></span><br><span class="line">$ curl http://localhost:9200/_cat/indices </span><br><span class="line">green  open .kibana_task_manager_1       GfxC_x2NQIGGkUEnhlFugA 1 0     2 0 31.5kb 31.5kb</span><br><span class="line">green  open kibana_sample_data_ecommerce 6IRUVk8qRKCO4p8DD5r0tw 1 0  4675 0  4.7mb  4.7mb</span><br><span class="line">green  open .apm-agent-configuration     Su0kz7ljSSW6GkIoUtddug 1 0     0 0   283b   283b</span><br><span class="line">green  open kibana_sample_data_logs      7DeKSAJ3T3KFhm48WEE14A 1 0 14074 0 11.7mb 11.7mb</span><br><span class="line">green  open kibana_sample_data_flights   d_Dw3tLzSWSEqSaL7ziGbw 1 0 13059 0  6.3mb  6.3mb</span><br><span class="line">green  open .kibana_1                    TYaPkgSGRyGhWdg657t4Cg 1 0   158 6    1mb    1mb</span><br><span class="line">yellow open customer                     OUgakvzFRHyZPp0ZmuKlQw 1 1     1 0   230b   230b</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除 customer 索引</span></span><br><span class="line">$ DELETE http://localhost:9200/customer</span><br><span class="line">&#123;</span><br><span class="line">	<span class="string">"acknowledged"</span>: <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查询所有索引，不存在 customer</span></span><br><span class="line">$ curl http://localhost:9200/_cat/indices </span><br><span class="line">green  open .kibana_task_manager_1       GfxC_x2NQIGGkUEnhlFugA 1 0     2 0 31.5kb 31.5kb</span><br><span class="line">green  open kibana_sample_data_ecommerce 6IRUVk8qRKCO4p8DD5r0tw 1 0  4675 0  4.7mb  4.7mb</span><br><span class="line">green  open .apm-agent-configuration     Su0kz7ljSSW6GkIoUtddug 1 0     0 0   283b   283b</span><br><span class="line">green  open kibana_sample_data_logs      7DeKSAJ3T3KFhm48WEE14A 1 0 14074 0 11.7mb 11.7mb</span><br><span class="line">green  open kibana_sample_data_flights   d_Dw3tLzSWSEqSaL7ziGbw 1 0 13059 0  6.3mb  6.3mb</span><br><span class="line">green  open .kibana_1                    TYaPkgSGRyGhWdg657t4Cg 1 0   158 6    1mb    1mb</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Elasticsearch 没有提供删除 type（类型）的操作。</p>
</blockquote>
<h2 id="批量-API"><a href="#批量-API" class="headerlink" title="批量 API"></a>批量 API</h2><p>Elasticserch 使用 <code>_bulk</code> 来做批量操作，语法如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ POST http://localhost:9200/customer/external/_bulk</span><br><span class="line"></span><br><span class="line">&#123;action: &#123;metadata&#125;&#125; \n</span><br><span class="line">&#123;request body&#125; \n</span><br><span class="line">&#123;action: &#123;metadata&#125;&#125; \n</span><br><span class="line">&#123;request body&#125; \n</span><br></pre></td></tr></table></figure>
<h4 id="批量新增"><a href="#批量新增" class="headerlink" title="批量新增"></a>批量新增</h4><p>批量新增，不指定 Id。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">POST /customer/external/_bulk</span><br><span class="line">&#123;<span class="string">"index"</span>:&#123;&#125;&#125;</span><br><span class="line">&#123;<span class="string">"name"</span>:<span class="string">"123"</span>&#125;</span><br><span class="line">&#123;<span class="string">"index"</span>:&#123;&#125;&#125;</span><br><span class="line">&#123;<span class="string">"name"</span>:<span class="string">"456"</span>&#125;</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"took"</span> : 8,                             <span class="comment"># 花费了8ms</span></span><br><span class="line">  <span class="string">"errors"</span> : <span class="literal">false</span>,                       <span class="comment"># 没有发生任何错误</span></span><br><span class="line">  <span class="string">"items"</span> : [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">"index"</span> : &#123;</span><br><span class="line">        <span class="string">"_index"</span> : <span class="string">"customer"</span>,</span><br><span class="line">        <span class="string">"_type"</span> : <span class="string">"external"</span>,</span><br><span class="line">        <span class="string">"_id"</span> : <span class="string">"oAXvG3kBh2g-jSNWkmM_"</span>,   <span class="comment"># 第一条记录Id</span></span><br><span class="line">        <span class="string">"_version"</span> : 1,</span><br><span class="line">        <span class="string">"result"</span> : <span class="string">"created"</span>,</span><br><span class="line">        <span class="string">"_shards"</span> : &#123;</span><br><span class="line">          <span class="string">"total"</span> : 2,</span><br><span class="line">          <span class="string">"successful"</span> : 1,</span><br><span class="line">          <span class="string">"failed"</span> : 0</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"_seq_no"</span> : 3,</span><br><span class="line">        <span class="string">"_primary_term"</span> : 1,</span><br><span class="line">        <span class="string">"status"</span> : 201</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">"index"</span> : &#123;</span><br><span class="line">        <span class="string">"_index"</span> : <span class="string">"customer"</span>,</span><br><span class="line">        <span class="string">"_type"</span> : <span class="string">"external"</span>,</span><br><span class="line">        <span class="string">"_id"</span> : <span class="string">"oQXvG3kBh2g-jSNWkmM_"</span>,   <span class="comment"># 第二条记录Id</span></span><br><span class="line">        <span class="string">"_version"</span> : 1,</span><br><span class="line">        <span class="string">"result"</span> : <span class="string">"created"</span>,</span><br><span class="line">        <span class="string">"_shards"</span> : &#123;</span><br><span class="line">          <span class="string">"total"</span> : 2,</span><br><span class="line">          <span class="string">"successful"</span> : 1,</span><br><span class="line">          <span class="string">"failed"</span> : 0</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"_seq_no"</span> : 4,</span><br><span class="line">        <span class="string">"_primary_term"</span> : 1,</span><br><span class="line">        <span class="string">"status"</span> : 201</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">GET /customer/external/oAXvG3kBh2g-jSNWkmM_</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"_index"</span> : <span class="string">"customer"</span>,</span><br><span class="line">  <span class="string">"_type"</span> : <span class="string">"external"</span>,</span><br><span class="line">  <span class="string">"_id"</span> : <span class="string">"oAXvG3kBh2g-jSNWkmM_"</span>,</span><br><span class="line">  <span class="string">"_version"</span> : 1,</span><br><span class="line">  <span class="string">"_seq_no"</span> : 2,</span><br><span class="line">  <span class="string">"_primary_term"</span> : 1,</span><br><span class="line">  <span class="string">"found"</span> : <span class="literal">true</span>,</span><br><span class="line">  <span class="string">"_source"</span> : &#123;</span><br><span class="line">    <span class="string">"name"</span> : <span class="string">"123"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>批量新增，指定 Id。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">POST /customer/external/_bulk</span><br><span class="line">&#123;<span class="string">"index"</span>:&#123;<span class="string">"_id"</span>: <span class="string">"1"</span>&#125;&#125;</span><br><span class="line">&#123;<span class="string">"name"</span>:<span class="string">"123"</span>&#125;</span><br><span class="line">&#123;<span class="string">"index"</span>:&#123;<span class="string">"_id"</span>: <span class="string">"2"</span>&#125;&#125;</span><br><span class="line">&#123;<span class="string">"name"</span>:<span class="string">"456"</span>&#125;</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"took"</span> : 99,</span><br><span class="line">  <span class="string">"errors"</span> : <span class="literal">false</span>,</span><br><span class="line">  <span class="string">"items"</span> : [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">"index"</span> : &#123;</span><br><span class="line">        <span class="string">"_index"</span> : <span class="string">"customer"</span>,</span><br><span class="line">        <span class="string">"_type"</span> : <span class="string">"external"</span>,</span><br><span class="line">        <span class="string">"_id"</span> : <span class="string">"1"</span>,</span><br><span class="line">        <span class="string">"_version"</span> : 3,</span><br><span class="line">        <span class="string">"result"</span> : <span class="string">"updated"</span>,</span><br><span class="line">        <span class="string">"_shards"</span> : &#123;</span><br><span class="line">          <span class="string">"total"</span> : 2,</span><br><span class="line">          <span class="string">"successful"</span> : 1,</span><br><span class="line">          <span class="string">"failed"</span> : 0</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"_seq_no"</span> : 5,</span><br><span class="line">        <span class="string">"_primary_term"</span> : 1,</span><br><span class="line">        <span class="string">"status"</span> : 200</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">"index"</span> : &#123;</span><br><span class="line">        <span class="string">"_index"</span> : <span class="string">"customer"</span>,</span><br><span class="line">        <span class="string">"_type"</span> : <span class="string">"external"</span>,</span><br><span class="line">        <span class="string">"_id"</span> : <span class="string">"2"</span>,</span><br><span class="line">        <span class="string">"_version"</span> : 1,</span><br><span class="line">        <span class="string">"result"</span> : <span class="string">"created"</span>,</span><br><span class="line">        <span class="string">"_shards"</span> : &#123;</span><br><span class="line">          <span class="string">"total"</span> : 2,</span><br><span class="line">          <span class="string">"successful"</span> : 1,</span><br><span class="line">          <span class="string">"failed"</span> : 0</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"_seq_no"</span> : 6,</span><br><span class="line">        <span class="string">"_primary_term"</span> : 1,</span><br><span class="line">        <span class="string">"status"</span> : 201</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">GET /customer/external/2</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"_index"</span> : <span class="string">"customer"</span>,</span><br><span class="line">  <span class="string">"_type"</span> : <span class="string">"external"</span>,</span><br><span class="line">  <span class="string">"_id"</span> : <span class="string">"2"</span>,</span><br><span class="line">  <span class="string">"_version"</span> : 1,</span><br><span class="line">  <span class="string">"_seq_no"</span> : 6,</span><br><span class="line">  <span class="string">"_primary_term"</span> : 1,</span><br><span class="line">  <span class="string">"found"</span> : <span class="literal">true</span>,</span><br><span class="line">  <span class="string">"_source"</span> : &#123;</span><br><span class="line">    <span class="string">"name"</span> : <span class="string">"456"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="批量修改"><a href="#批量修改" class="headerlink" title="批量修改"></a>批量修改</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">POST /customer/external/_bulk</span><br><span class="line"><span class="comment"># 修改操作，重试3次。</span></span><br><span class="line">&#123;<span class="string">"update"</span> : &#123;<span class="string">"_index"</span>: <span class="string">"website"</span>, <span class="string">"_type"</span>: <span class="string">"blog"</span>, <span class="string">"_id"</span>: <span class="string">"123"</span>,<span class="string">"_retry_on_confict"</span>: 3&#125;&#125;	</span><br><span class="line"><span class="comment"># 修改内容</span></span><br><span class="line">&#123;<span class="string">"doc"</span>	 : &#123;<span class="string">"title"</span>: <span class="string">"My update blog post"</span>&#125;&#125;		</span><br><span class="line"><span class="comment"># 修改操作，重试3次。</span></span><br><span class="line">&#123;<span class="string">"update"</span> : &#123;<span class="string">"_index"</span>: <span class="string">"website"</span>, <span class="string">"_type"</span>: <span class="string">"blog"</span>, <span class="string">"_id"</span>: <span class="string">"123"</span>,<span class="string">"_retry_on_confict"</span>: 3&#125;&#125;	</span><br><span class="line"><span class="comment"># 修改内容</span></span><br><span class="line">&#123;<span class="string">"doc"</span>	 : &#123;<span class="string">"title"</span>: <span class="string">"My update blog post"</span>&#125;&#125;</span><br></pre></td></tr></table></figure>
<h4 id="批量删除"><a href="#批量删除" class="headerlink" title="批量删除"></a>批量删除</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">POST /customer/external/_bulk</span><br><span class="line">&#123;<span class="string">"delete"</span> : <span class="string">"_index"</span>, <span class="string">"website"</span>, <span class="string">"_type"</span>: <span class="string">"blog"</span>, <span class="string">"_id"</span>: <span class="string">"123"</span>&#125;		</span><br><span class="line">&#123;<span class="string">"delete"</span> : <span class="string">"_index"</span>, <span class="string">"website"</span>, <span class="string">"_type"</span>: <span class="string">"blog"</span>, <span class="string">"_id"</span>: <span class="string">"123"</span>&#125;</span><br></pre></td></tr></table></figure>
<h4 id="混合操作"><a href="#混合操作" class="headerlink" title="混合操作"></a>混合操作</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">POST /customer/external/_bulk</span><br><span class="line"><span class="comment"># 删除操作</span></span><br><span class="line">&#123;<span class="string">"delete"</span> : <span class="string">"_index"</span>, <span class="string">"website"</span>, <span class="string">"_type"</span>: <span class="string">"blog"</span>, <span class="string">"_id"</span>: <span class="string">"123"</span>&#125;									</span><br><span class="line"><span class="comment"># 创建操作，和 index 类似</span></span><br><span class="line">&#123;<span class="string">"create"</span> : &#123;<span class="string">"_index"</span>, <span class="string">"website"</span>, <span class="string">"_type"</span>: <span class="string">"blog"</span>, <span class="string">"_id"</span>: <span class="string">"123"</span>&#125;&#125;									</span><br><span class="line">&#123;<span class="string">"title"</span>  : <span class="string">"My First blog post"</span>&#125;																			</span><br><span class="line"><span class="comment"># 创建操作</span></span><br><span class="line">&#123;<span class="string">"index"</span>  : &#123;<span class="string">"_index"</span>, <span class="string">"website"</span>, <span class="string">"_type"</span>: <span class="string">"blog"</span>&#125;&#125;				</span><br><span class="line">&#123;<span class="string">"title"</span>  : <span class="string">"My Second blog post"</span>&#125;										</span><br><span class="line"><span class="comment"># 修改操作，重试3次。</span></span><br><span class="line">&#123;<span class="string">"update"</span> : &#123;<span class="string">"_index"</span>: <span class="string">"website"</span>, <span class="string">"_type"</span>: <span class="string">"blog"</span>, <span class="string">"_id"</span>: <span class="string">"123"</span>,<span class="string">"_retry_on_confict"</span>: 3&#125;&#125;	</span><br><span class="line"><span class="comment"># 修改内容</span></span><br><span class="line">&#123;<span class="string">"doc"</span>	 : &#123;<span class="string">"title"</span>: <span class="string">"My update blog post"</span>&#125;&#125;</span><br></pre></td></tr></table></figure>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Articles</a></li>
         
          <li><a href="/categories/">Categories</a></li>
         
          <li><a href="/search/">Search</a></li>
         
          <li><a href="/about/">About</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#cat"><span class="toc-number">1.</span> <span class="toc-text">_cat</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#查看-ES-健康信息"><span class="toc-number">1.0.1.</span> <span class="toc-text">查看 ES 健康信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#查看节点信息"><span class="toc-number">1.0.2.</span> <span class="toc-text">查看节点信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#查看主节点"><span class="toc-number">1.0.3.</span> <span class="toc-text">查看主节点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#查看所有索引"><span class="toc-number">1.0.4.</span> <span class="toc-text">查看所有索引</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#保存文档"><span class="toc-number">2.</span> <span class="toc-text">保存文档</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#POST-保存"><span class="toc-number">2.0.1.</span> <span class="toc-text">POST 保存</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#PUT-保存"><span class="toc-number">2.0.2.</span> <span class="toc-text">PUT  保存</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#查询文档"><span class="toc-number">3.</span> <span class="toc-text">查询文档</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#更新文档"><span class="toc-number">4.</span> <span class="toc-text">更新文档</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#删除文档"><span class="toc-number">5.</span> <span class="toc-text">删除文档</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#批量-API"><span class="toc-number">6.</span> <span class="toc-text">批量 API</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#批量新增"><span class="toc-number">6.0.1.</span> <span class="toc-text">批量新增</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#批量修改"><span class="toc-number">6.0.2.</span> <span class="toc-text">批量修改</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#批量删除"><span class="toc-number">6.0.3.</span> <span class="toc-text">批量删除</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#混合操作"><span class="toc-number">6.0.4.</span> <span class="toc-text">混合操作</span></a></li></ol></li></ol></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://yoursite.com/2021/04/18/后端开发/Elasticsearch 教程/Elasticsearch 初步检索/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://yoursite.com/2021/04/18/后端开发/Elasticsearch 教程/Elasticsearch 初步检索/&text=Elasticsearch 初步检索"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://yoursite.com/2021/04/18/后端开发/Elasticsearch 教程/Elasticsearch 初步检索/&title=Elasticsearch 初步检索"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://yoursite.com/2021/04/18/后端开发/Elasticsearch 教程/Elasticsearch 初步检索/&is_video=false&description=Elasticsearch 初步检索"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Elasticsearch 初步检索&body=Check out this article: http://yoursite.com/2021/04/18/后端开发/Elasticsearch 教程/Elasticsearch 初步检索/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://yoursite.com/2021/04/18/后端开发/Elasticsearch 教程/Elasticsearch 初步检索/&title=Elasticsearch 初步检索"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://yoursite.com/2021/04/18/后端开发/Elasticsearch 教程/Elasticsearch 初步检索/&title=Elasticsearch 初步检索"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://yoursite.com/2021/04/18/后端开发/Elasticsearch 教程/Elasticsearch 初步检索/&title=Elasticsearch 初步检索"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://yoursite.com/2021/04/18/后端开发/Elasticsearch 教程/Elasticsearch 初步检索/&title=Elasticsearch 初步检索"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://yoursite.com/2021/04/18/后端开发/Elasticsearch 教程/Elasticsearch 初步检索/&name=Elasticsearch 初步检索&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy; 2021 John Doe
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        
        <li><a href="/">Home</a></li>
        
        <li><a href="/archives/">Articles</a></li>
        
        <li><a href="/categories/">Categories</a></li>
        
        <li><a href="/search/">Search</a></li>
        
        <li><a href="/about/">About</a></li>
        
      </ul>
    </nav>
  </div>
</footer>


<!-- 根据页面mathjax变量决定是否加载MathJax数学公式js -->

    </div>
    <!-- styles -->
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
<link rel="stylesheet" href="/lib/justified-gallery/css/justifiedGallery.min.css">

    <!-- jquery -->
<script src="/lib/jquery/jquery.min.js"></script>
<script src="/lib/justified-gallery/js/jquery.justifiedGallery.min.js"></script>
<!-- clipboard -->

  <script src="/lib/clipboard/clipboard.min.js"></script>
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight .code pre").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      target: function(trigger) {
        return trigger.nextElementSibling;
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>

<script src="/js/main.js"></script>
<!-- search -->

<!-- Google Analytics -->

<!-- Baidu Analytics -->

<!-- Disqus Comments -->


</body>
</html>
