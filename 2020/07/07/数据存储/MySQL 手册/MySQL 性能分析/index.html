<!DOCTYPE html>
<html lang=en>
<head><meta name="generator" content="Hexo 3.9.0">
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="description" content="MySQL 数据库性能遇到瓶颈，如何快速定位问题的原因，是每个 DBA 或系统运维人员应该思考的问题。正确的借助一些性能分析工具，能够帮助 DBA 或系统运维人员进行问题快速的定位。 性能指标下面是 MySQL 数据库，或者说所有数据库的三个关键性能指标：  QPS 每秒处理的查询数 TPS 每秒处理的事务数 IOPS 每秒磁盘进行的I/O操作次数  QPSTPSTransactions Per">
<meta property="og:type" content="article">
<meta property="og:title" content="MySQL 性能分析">
<meta property="og:url" content="http://yoursite.com/2020/07/07/数据存储/MySQL 手册/MySQL 性能分析/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="MySQL 数据库性能遇到瓶颈，如何快速定位问题的原因，是每个 DBA 或系统运维人员应该思考的问题。正确的借助一些性能分析工具，能够帮助 DBA 或系统运维人员进行问题快速的定位。 性能指标下面是 MySQL 数据库，或者说所有数据库的三个关键性能指标：  QPS 每秒处理的查询数 TPS 每秒处理的事务数 IOPS 每秒磁盘进行的I/O操作次数  QPSTPSTransactions Per">
<meta property="og:locale" content="en">
<meta property="og:image" content="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9tbWJpei5xcGljLmNuL21tYml6X3BuZy9FbnpBd3ZwVFFKNzY5TTZaaWNvbjRWVGdpY2FMdTNyN0s2R2lhY21zTjgySE1JZFh5aWJWWjFOZmhmeUxJOGlhWUl4SU54UFdxa1Nsalh5UFlxSHJOMVU2MWljUS82NDA_d3hfZm10PXBuZw?x-oss-process=image/format,png">
<meta property="og:image" content="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9tbWJpei5xcGljLmNuL21tYml6X3BuZy9FbnpBd3ZwVFFKNzY5TTZaaWNvbjRWVGdpY2FMdTNyN0s2M0pydlYyMlNWbENuRU1HZm1jSXBxaWNOWGliV2I4elBVbjdLMUVURnIzNWNXdmliQWYzQUlDRjV3LzY0MD93eF9mbXQ9cG5n?x-oss-process=image/format,png">
<meta property="og:image" content="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9tbWJpei5xcGljLmNuL21tYml6X3BuZy9FbnpBd3ZwVFFKNzY5TTZaaWNvbjRWVGdpY2FMdTNyN0s2YnB2ZVlBUGxqaGlhWVpIaWNWeTh1cW1ycWc1T1l1V0FGM2FURDR0Q3hZaWFUQkVpYVpoUGRKcFIxQS82NDA_d3hfZm10PXBuZw?x-oss-process=image/format,png">
<meta property="og:image" content="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9tbWJpei5xcGljLmNuL21tYml6X3BuZy9FbnpBd3ZwVFFKNzY5TTZaaWNvbjRWVGdpY2FMdTNyN0s2empYMm04ZG4yUDZvbXNTZkwxSFg2UFZKVlVjQUlsR1ZzSTB5cWw1ZWJNdTZIaGROV292aWJSQS82NDA_d3hfZm10PXBuZw?x-oss-process=image/format,png">
<meta property="og:image" content="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9tbWJpei5xcGljLmNuL21tYml6X3BuZy9FbnpBd3ZwVFFKNzY5TTZaaWNvbjRWVGdpY2FMdTNyN0s2dHRsV3U3cENLQlBmZWtPdXdzbnZPOEZpY3gxRmRFbFRSRU9NWlVzUDY2MmV6eWhudXRiNHltZy82NDA_d3hfZm10PXBuZw?x-oss-process=image/format,png">
<meta property="og:image" content="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9tbWJpei5xcGljLmNuL21tYml6X3BuZy9FbnpBd3ZwVFFKNzY5TTZaaWNvbjRWVGdpY2FMdTNyN0s2OUk5V29JM1RKRkdrSzJ5cG1YWDdYc2FpY2NzVjhqVDdCUjU5d0JyeTV3a0htRzJ2ZmhMU2Nrdy82NDA_d3hfZm10PXBuZw?x-oss-process=image/format,png">
<meta property="og:image" content="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9tbWJpei5xcGljLmNuL21tYml6X3BuZy9FbnpBd3ZwVFFKNzY5TTZaaWNvbjRWVGdpY2FMdTNyN0s2UUFNcHh4TzI5R0huOEwxbmhYbmJTc2JBOFRHa2ljY1dpYVBsS3ptNWhLb1k3Q1RpYVRWU1o3U0ZnLzY0MD93eF9mbXQ9cG5n?x-oss-process=image/format,png">
<meta property="og:image" content="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9tbWJpei5xcGljLmNuL21tYml6X3BuZy9FbnpBd3ZwVFFKNzY5TTZaaWNvbjRWVGdpY2FMdTNyN0s2enNxUFlXQWlhc0RySThYZXMzT2xGVmV1eXlpY0hmZ0ZhYXVPNlNpYTBCRVhqekhCTjB6RGQzNmliQS82NDA_d3hfZm10PXBuZw?x-oss-process=image/format,png">
<meta property="og:updated_time" content="2021-05-04T03:46:25.858Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="MySQL 性能分析">
<meta name="twitter:description" content="MySQL 数据库性能遇到瓶颈，如何快速定位问题的原因，是每个 DBA 或系统运维人员应该思考的问题。正确的借助一些性能分析工具，能够帮助 DBA 或系统运维人员进行问题快速的定位。 性能指标下面是 MySQL 数据库，或者说所有数据库的三个关键性能指标：  QPS 每秒处理的查询数 TPS 每秒处理的事务数 IOPS 每秒磁盘进行的I/O操作次数  QPSTPSTransactions Per">
<meta name="twitter:image" content="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9tbWJpei5xcGljLmNuL21tYml6X3BuZy9FbnpBd3ZwVFFKNzY5TTZaaWNvbjRWVGdpY2FMdTNyN0s2R2lhY21zTjgySE1JZFh5aWJWWjFOZmhmeUxJOGlhWUl4SU54UFdxa1Nsalh5UFlxSHJOMVU2MWljUS82NDA_d3hfZm10PXBuZw?x-oss-process=image/format,png">
    
    
        
          
              <link rel="shortcut icon" href="/images/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
          
        
    
    <!-- title -->
    <title>MySQL 性能分析</title>
    <!-- styles -->
    <link rel="stylesheet" href="/css/style.css">
    <!-- persian styles -->
    
      <link rel="stylesheet" href="/css/rtl.css">
    
    <!-- rss -->
    
    
</head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Articles</a></li>
         
          <li><a href="/categories/">Categories</a></li>
         
          <li><a href="/search/">Search</a></li>
         
          <li><a href="/about/">About</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/2020/07/07/数据存储/MySQL 手册/MySQL 基准测试/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" href="/2020/07/07/数据存储/MySQL 手册/MySQL 性能优化/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://yoursite.com/2020/07/07/数据存储/MySQL 手册/MySQL 性能分析/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://yoursite.com/2020/07/07/数据存储/MySQL 手册/MySQL 性能分析/&text=MySQL 性能分析"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://yoursite.com/2020/07/07/数据存储/MySQL 手册/MySQL 性能分析/&title=MySQL 性能分析"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://yoursite.com/2020/07/07/数据存储/MySQL 手册/MySQL 性能分析/&is_video=false&description=MySQL 性能分析"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=MySQL 性能分析&body=Check out this article: http://yoursite.com/2020/07/07/数据存储/MySQL 手册/MySQL 性能分析/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://yoursite.com/2020/07/07/数据存储/MySQL 手册/MySQL 性能分析/&title=MySQL 性能分析"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://yoursite.com/2020/07/07/数据存储/MySQL 手册/MySQL 性能分析/&title=MySQL 性能分析"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://yoursite.com/2020/07/07/数据存储/MySQL 手册/MySQL 性能分析/&title=MySQL 性能分析"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://yoursite.com/2020/07/07/数据存储/MySQL 手册/MySQL 性能分析/&title=MySQL 性能分析"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://yoursite.com/2020/07/07/数据存储/MySQL 手册/MySQL 性能分析/&name=MySQL 性能分析&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#性能指标"><span class="toc-number">1.</span> <span class="toc-text">性能指标</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#QPS"><span class="toc-number">1.0.1.</span> <span class="toc-text">QPS</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#TPS"><span class="toc-number">1.0.2.</span> <span class="toc-text">TPS</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#show-status"><span class="toc-number">2.</span> <span class="toc-text">show status</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Query-Profiler"><span class="toc-number">3.</span> <span class="toc-text">Query Profiler</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#explain"><span class="toc-number">4.</span> <span class="toc-text">explain</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#慢日志查询"><span class="toc-number">5.</span> <span class="toc-text">慢日志查询</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#查询慢日志配置"><span class="toc-number">5.0.1.</span> <span class="toc-text">查询慢日志配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#开启慢日志查询"><span class="toc-number">5.0.2.</span> <span class="toc-text">开启慢日志查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#关闭慢日志查询"><span class="toc-number">5.0.3.</span> <span class="toc-text">关闭慢日志查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#其他操作"><span class="toc-number">5.0.4.</span> <span class="toc-text">其他操作</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#explain-优化案例"><span class="toc-number">6.</span> <span class="toc-text">explain 优化案例</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#表结构"><span class="toc-number">6.0.1.</span> <span class="toc-text">表结构</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#待优化-SQL"><span class="toc-number">6.0.2.</span> <span class="toc-text">待优化 SQL</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#数据量"><span class="toc-number">6.0.3.</span> <span class="toc-text">数据量</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#原执行时间"><span class="toc-number">6.0.4.</span> <span class="toc-text">原执行时间</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#原实行计划"><span class="toc-number">6.0.5.</span> <span class="toc-text">原实行计划</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#初步优化思路"><span class="toc-number">6.0.6.</span> <span class="toc-text">初步优化思路</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#初步优化SQL"><span class="toc-number">6.0.7.</span> <span class="toc-text">初步优化SQL</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#优化后执行时间"><span class="toc-number">6.0.8.</span> <span class="toc-text">优化后执行时间</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#优化后执行计划"><span class="toc-number">6.0.9.</span> <span class="toc-text">优化后执行计划</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#查看-warnings-信息"><span class="toc-number">6.0.10.</span> <span class="toc-text">查看 warnings 信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#继续优化-gmt-create"><span class="toc-number">6.0.11.</span> <span class="toc-text">继续优化 gmt_create</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#查看执行时间"><span class="toc-number">6.0.12.</span> <span class="toc-text">查看执行时间</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#查看执行计划"><span class="toc-number">6.0.13.</span> <span class="toc-text">查看执行计划</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#总结"><span class="toc-number">6.0.14.</span> <span class="toc-text">总结</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SHOW-PROCESSLIST"><span class="toc-number">7.</span> <span class="toc-text">SHOW PROCESSLIST</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#索引的性能对比"><span class="toc-number">8.</span> <span class="toc-text">索引的性能对比</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#存储引擎的性能对比"><span class="toc-number">9.</span> <span class="toc-text">存储引擎的性能对比</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#单线程写"><span class="toc-number">9.0.1.</span> <span class="toc-text">单线程写</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#多线程写"><span class="toc-number">9.0.2.</span> <span class="toc-text">多线程写</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#单进程读"><span class="toc-number">9.0.3.</span> <span class="toc-text">单进程读</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#多进程读"><span class="toc-number">9.0.4.</span> <span class="toc-text">多进程读</span></a></li></ol></li></ol></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        MySQL 性能分析
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">Hexo</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2020-07-07T00:00:01.000Z" itemprop="datePublished">2020-07-07</time>
        
        (Updated: <time datetime="2021-05-04T03:46:25.858Z" itemprop="dateModified">2021-05-04</time>)
        
      
    </div>


      
    <div class="article-category">
        <i class="fas fa-archive"></i>
        <a class="category-link" href="/categories/数据存储/">数据存储</a> › <a class="category-link" href="/categories/数据存储/MySQL-手册/">MySQL 手册</a>
    </div>


      

    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <p>MySQL 数据库性能遇到瓶颈，如何快速定位问题的原因，是每个 DBA 或系统运维人员应该思考的问题。正确的借助一些性能分析工具，能够帮助 DBA 或系统运维人员进行问题快速的定位。</p>
<h2 id="性能指标"><a href="#性能指标" class="headerlink" title="性能指标"></a>性能指标</h2><p>下面是 MySQL 数据库，或者说所有数据库的三个关键性能指标：</p>
<ol>
<li>QPS 每秒处理的查询数</li>
<li>TPS 每秒处理的事务数</li>
<li>IOPS 每秒磁盘进行的I/O操作次数</li>
</ol>
<h4 id="QPS"><a href="#QPS" class="headerlink" title="QPS"></a>QPS</h4><h4 id="TPS"><a href="#TPS" class="headerlink" title="TPS"></a>TPS</h4><p>Transactions Per Second，即服务器每秒处理的事务数，适用 InnoDB 存储引擎。</p>
<p>TPS 是软件测试结果的测量单位。一个事务是指一个客户机向服务器发送请求然后服务器做出反应的过程。客户机在发送请求时开始计时，收到服务器响应后结束计时，以此来计算使用的时间和完成的事务个数。</p>
<p>一般的，评价系统性能均以每秒钟完成的技术交易的数量来衡量。系统整体处理能力取决于处理能力最低模块的 TPS 值。</p>
<p>???</p>
<h2 id="show-status"><a href="#show-status" class="headerlink" title="show status"></a>show status</h2><p><code>show status</code> 命令可以查看 MySQL 服务器的状态信息。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">- 查询当前MySQL本次启动后的运行统计时间</span><br><span class="line"><span class="keyword">show</span> <span class="keyword">status</span> <span class="keyword">like</span> <span class="string">'uptime'</span>;</span><br><span class="line">+<span class="comment">---------------+-------+</span></span><br><span class="line">| Variable_name | Value |</span><br><span class="line">+<span class="comment">---------------+-------+</span></span><br><span class="line">| Uptime        | 5667  |</span><br><span class="line">+<span class="comment">---------------+-------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">- 本次MySQL启动后执行的<span class="keyword">SELECT</span>语句的次数</span><br><span class="line"><span class="keyword">show</span> <span class="keyword">status</span> <span class="keyword">like</span> <span class="string">'com_select'</span>;</span><br><span class="line">- 本次MySQL启动后执行的<span class="keyword">INSERT</span>语句的次数</span><br><span class="line"><span class="keyword">show</span> <span class="keyword">status</span> <span class="keyword">like</span> <span class="string">'com_insert'</span>;</span><br><span class="line">- 本次MySQL启动后执行的<span class="keyword">UPDATE</span>语句的次数</span><br><span class="line"><span class="keyword">show</span> <span class="keyword">status</span> <span class="keyword">like</span> <span class="string">'com_update'</span>;</span><br><span class="line">- 本次MySQL启动后执行的<span class="keyword">DELETE</span>语句的次数</span><br><span class="line"><span class="keyword">show</span> <span class="keyword">status</span> <span class="keyword">like</span> <span class="string">'com_delete'</span>;</span><br><span class="line"></span><br><span class="line">+<span class="comment">---------------+-------+</span></span><br><span class="line">| Variable_name | Value |</span><br><span class="line">+<span class="comment">---------------+-------+</span></span><br><span class="line">| Com_select    | 1     |</span><br><span class="line">+<span class="comment">---------------+-------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">- 查看MySQL服务器的线程信息</span><br><span class="line"><span class="keyword">show</span> <span class="keyword">status</span> <span class="keyword">like</span> <span class="string">'Thread_%'</span>;</span><br><span class="line">+<span class="comment">-------------------+-------+</span></span><br><span class="line">| Variable_name     | Value |</span><br><span class="line">+<span class="comment">-------------------+-------+</span></span><br><span class="line">| Threads_cached    | 0     |</span><br><span class="line">| Threads_connected | 1     |</span><br><span class="line">| Threads_created   | 1     |</span><br><span class="line">| Threads_running   | 1     |</span><br><span class="line">+<span class="comment">-------------------+-------+</span></span><br><span class="line">4 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">- 查看试图连接到MySQL(不管是否连接成功)的连接数</span><br><span class="line"><span class="keyword">show</span> <span class="keyword">status</span> <span class="keyword">like</span> <span class="string">'connections'</span>;</span><br><span class="line"></span><br><span class="line">- 查看当前打开的连接的数量。</span><br><span class="line"><span class="keyword">show</span> <span class="keyword">status</span> <span class="keyword">like</span> <span class="string">'threads_connected'</span>;</span><br><span class="line"></span><br><span class="line">- 查看当前打开的连接的数量。</span><br><span class="line"><span class="keyword">show</span> <span class="keyword">status</span> <span class="keyword">like</span> <span class="string">'threads_connected'</span>;</span><br><span class="line"></span><br><span class="line">- 查看创建用来处理连接的线程数。如果Threads_created较大，你可能要增加thread_cache_size值。</span><br><span class="line"><span class="keyword">show</span> <span class="keyword">status</span> <span class="keyword">like</span> <span class="string">'threads_created'</span>;</span><br><span class="line"></span><br><span class="line">- 查看激活的(非睡眠状态)线程数。</span><br><span class="line"><span class="keyword">show</span> <span class="keyword">status</span> <span class="keyword">like</span> <span class="string">'threads_running'</span>;</span><br><span class="line"></span><br><span class="line">- 查看立即获得的表的锁的次数。</span><br><span class="line"><span class="keyword">show</span> <span class="keyword">status</span> <span class="keyword">like</span> <span class="string">'table_locks_immediate'</span>;</span><br><span class="line"></span><br><span class="line">- 查看不能立即获得的表的锁的次数。如果该值较高，并且有性能问题，你应首先优化查询，然后拆分表或使用复制。</span><br><span class="line"><span class="keyword">show</span> <span class="keyword">status</span> <span class="keyword">like</span> <span class="string">'table_locks_waited'</span>;</span><br><span class="line"></span><br><span class="line">- 查看创建时间超过slow_launch_time秒的线程数。</span><br><span class="line"><span class="keyword">show</span> <span class="keyword">status</span> <span class="keyword">like</span> <span class="string">'slow_launch_threads'</span>;</span><br><span class="line"></span><br><span class="line">- 查看查询时间超过long_query_time秒的查询的个数。</span><br><span class="line"><span class="keyword">show</span> <span class="keyword">status</span> <span class="keyword">like</span> <span class="string">'slow_queries'</span>;</span><br></pre></td></tr></table></figure>
<h2 id="Query-Profiler"><a href="#Query-Profiler" class="headerlink" title="Query Profiler"></a>Query Profiler</h2><p>Query Profiler 是 MySQL 自带的一种查询诊断分析工具，通过它可以分析出一条SQL语句的性能瓶颈在什么地方。</p>
<p>查询类型包括：</p>
<ol>
<li>ALL 显示所有性能信息</li>
<li>BLOCK IO 显示块IO操作的次数</li>
<li>CONTEXT SWITCHES 显示上下文切换次数，不管是主动还是被动</li>
<li>CPU 显示用户CPU时间、系统CPU时间</li>
<li>IPC 显示发送和接收的消息数量</li>
<li>MEMORY [暂未实现]</li>
<li>PAGE FAULTS 显示页错误数量</li>
<li>SOURCE 显示源码中的函数名称与位置</li>
<li>SWAPS 显示SWAP的次数</li>
</ol>
<p>结果参数说明：</p>
<ol>
<li>System lock<br> 确认是由于哪个锁引起的，通常是因为MySQL或InnoDB内核级的锁引起的建议：如果耗时较大再关注即可，一般情况下都还好</li>
<li>Sending data<br> 从server端发送数据到客户端，也有可能是接收存储引擎层返回的数据，再发送给客户端，数据量很大时尤其经常能看见<br> 备注：Sending Data不是网络发送，是从硬盘读取，发送到网络是Writing to net<br> 建议：通过索引或加上LIMIT，减少需要扫描并且发送给客户端的数据量</li>
<li>Sorting result<br> 正在对结果进行排序，类似Creating sort index，不过是正常表，而不是在内存表中进行排序<br> 建议：创建适当的索引</li>
<li>Table lock<br> 表级锁，没什么好说的，要么是因为MyISAM引擎表级锁，要么是其他情况显式锁表</li>
<li>create sort index<br> 当前的SELECT中需要用到临时表在进行ORDER BY排序<br> 建议：创建适当的索引</li>
</ol>
<p>示例：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"># 查看是否开启了Profile功能，0未开启 1开启</span><br><span class="line">&gt; select @@profiling;</span><br><span class="line"></span><br><span class="line"># 开启Profile功能</span><br><span class="line">&gt; set profiling=1;</span><br><span class="line"></span><br><span class="line"># 测试查询语句</span><br><span class="line">&gt; select * from biz_sku</span><br><span class="line"></span><br><span class="line"># 查询此语句的queryId</span><br><span class="line">&gt; show profiles;</span><br><span class="line">351	0.00053725	<span class="keyword">select</span> * <span class="keyword">from</span> biz_sku</span><br><span class="line"></span><br><span class="line"># 查询此queryId的性能消耗</span><br><span class="line">&gt; <span class="keyword">show</span>  profile <span class="keyword">for</span> <span class="keyword">query</span> <span class="number">351</span>;</span><br><span class="line"></span><br><span class="line"># 查询此queryId指定资源类型的性能消耗</span><br><span class="line">&gt; show  profile cpu ,swaps for query 351;</span><br><span class="line"></span><br><span class="line">Status	                Duration	CPU_user	CPU_system	Swaps</span><br><span class="line">starting	        0.000021	0.000000	0.000000	0    </span><br><span class="line">checking permissions	0.000007	0.000000	0.000000	0</span><br><span class="line">Opening tables	        0.000015	0.000000	0.000000	0</span><br><span class="line">init	                0.000026	0.000000	0.000000	0</span><br><span class="line">System <span class="keyword">lock</span>	        <span class="number">0.000007</span>	<span class="number">0.000000</span>	<span class="number">0.000000</span>	<span class="number">0</span></span><br><span class="line">optimizing	        <span class="number">0.000003</span>	<span class="number">0.000000</span>	<span class="number">0.000000</span>	<span class="number">0</span></span><br><span class="line"><span class="keyword">statistics</span>	        <span class="number">0.000009</span>	<span class="number">0.000000</span>	<span class="number">0.000000</span>	<span class="number">0</span></span><br><span class="line">preparing	        <span class="number">0.000008</span>	<span class="number">0.000000</span>	<span class="number">0.000000</span>	<span class="number">0</span></span><br><span class="line">executing	        <span class="number">0.000002</span>	<span class="number">0.000000</span>	<span class="number">0.000000</span>	<span class="number">0</span></span><br><span class="line">Sending <span class="keyword">data</span>	        <span class="number">0.000481</span>	<span class="number">0.000000</span>	<span class="number">0.000000</span>	<span class="number">0</span></span><br><span class="line"><span class="keyword">end</span>	                <span class="number">0.000005</span>	<span class="number">0.000000</span>	<span class="number">0.000000</span>	<span class="number">0</span></span><br><span class="line"><span class="keyword">query</span> <span class="keyword">end</span>	        <span class="number">0.000006</span>	<span class="number">0.000000</span>	<span class="number">0.000000</span>	<span class="number">0</span></span><br><span class="line">closing <span class="keyword">tables</span>	        <span class="number">0.000012</span>	<span class="number">0.000000</span>	<span class="number">0.000000</span>	<span class="number">0</span></span><br><span class="line">freeing items	        <span class="number">0.000011</span>	<span class="number">0.000000</span>	<span class="number">0.000000</span>	<span class="number">0</span></span><br><span class="line">cleaning up	        <span class="number">0.000003</span>	<span class="number">0.000000</span>	<span class="number">0.000000</span>	<span class="number">0</span></span><br></pre></td></tr></table></figure>
<h2 id="explain"><a href="#explain" class="headerlink" title="explain"></a>explain</h2><p>MySQL 提供了一个 explain 命令用来对 select 语句进行分析，并输出执行的详细信息，以供开发人员针对性优化。</p>
<p>使用：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; explain select * from servers;</span><br><span class="line">+<span class="comment">----+-------------+---------+------+---------------+------+---------+------+------+-------+</span></span><br><span class="line">| id | select_type | table   | type | possible_keys | key  | key_len | ref  | rows | Extra |</span><br><span class="line">+<span class="comment">----+-------------+---------+------+---------------+------+---------+------+------+-------+</span></span><br><span class="line">|  1 | SIMPLE      | servers | ALL  | NULL          | NULL | NULL    | NULL |    1 | NULL  |</span><br><span class="line">+<span class="comment">----+-------------+---------+------+---------------+------+---------+------+------+-------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.03</span> sec)</span><br></pre></td></tr></table></figure>
<p>各列的含义如下：</p>
<ol>
<li><strong>id</strong><br> SQL执行的顺序的标识，SQL从大到小的执行。如果id相同，则从上到下。</li>
<li><strong>select_type</strong><br> 表示查询中每个select子句的类型。</li>
<li><strong>table</strong><br> 显示这一行的数据是关于哪张表的，有时不是真实的表名字，看到的是derivedx（x是个数字，我的理解是第几步执行的结果）</li>
<li><strong>type</strong><br> 表示MySQL在表中找到所需行的方式，又称“访问类型”。</li>
<li><strong>possible_keys</strong><br> 指出 MySQL 能使用哪个索引在表中找到记录，查询涉及到的字段上若存在索引，则该索引将被列出，但不一定被查询使用。</li>
<li><strong>Key</strong><br> 显示 MySQL 实际决定使用的键（索引）</li>
<li><strong>key_len</strong><br> 表示索引中使用的字节数，可通过该列计算查询中使用的索引的长度（key_len显示的值为索引字段的最大可能长度，并非实际使用长度，即key_len是根据表定义计算而得，不是通过表内检索出的）</li>
<li><strong>ref</strong><br> 表示上述表的连接匹配条件，即哪些列或常量被用于查找索引列上的值</li>
<li><strong>rows</strong><br> 表示MySQL根据表统计信息及索引选用情况，估算的找到所需的记录所需要读取的行数</li>
<li><strong>extra</strong><br> 该列包含MySQL解决查询的详细信息</li>
</ol>
<p><strong>select_type</strong> 可选值:</p>
<ol>
<li>SIMPLE<br> 简单SELECT,不使用UNION或子查询等</li>
<li>PRIMARY<br> 查询中若包含任何复杂的子部分,最外层的select被标记为PRIMARY</li>
<li>UNION<br> UNION中的第二个或后面的SELECT语句</li>
<li>DEPENDENT<br> UNION UNION中的第二个或后面的SELECT语句，取决于外面的查询</li>
<li>UNION<br> RESULT (UNION的结果</li>
<li>SUBQUERY<br> 子查询中的第一个SELECT</li>
<li>DEPENDENT<br> SUBQUERY 子查询中的第一个SELECT，取决于外面的查询</li>
<li>DERIVED<br> 派生表的SELECT, FROM子句的子查询</li>
<li>UNCACHEABLE SUBQUERY<br> 一个子查询的结果不能被缓存，必须重新评估外链接的第一行</li>
</ol>
<p><strong>type</strong> 可选值：</p>
<ol>
<li>all<br> Full Table Scan， MySQL将遍历全表以找到匹配的行</li>
<li>index<br> Full Index Scan，index与ALL区别为index类型只遍历索引树</li>
<li>range<br> 只检索给定范围的行，使用一个索引来选择行</li>
<li>ref<br> 表示上述表的连接匹配条件，即哪些列或常量被用于查找索引列上的值</li>
<li>eq_ref<br> 类似ref，区别就在使用的索引是唯一索引，对于每个索引键值，表中只有一条记录匹配，简单来说，就是多表连接中使用primary key或者 unique key作为关联条件</li>
<li>const、system<br> 当MySQL对查询某部分进行优化，并转换为一个常量时，使用这些类型访问。如将主键置于where列表中，MySQL就能将该查询转换为一个常量,system是const类型的特例，当查询的表只有一行的情况下，使用system</li>
<li>null<br> MySQL在优化过程中分解语句，执行时甚至不用访问表或索引，例如从一个索引列里选取最小值可以通过单独索引查找完成。</li>
</ol>
<p><strong>extra</strong> 可选值：</p>
<ol>
<li>Using where<br> 列数据是从仅仅使用了索引中的信息而没有读取实际的行动的表返回的，这发生在对表的全部的请求列都是同一个索引的部分的时候，表示mysql服务器将在存储引擎检索行后再进行过滤。</li>
<li>Using temporary<br> 表示MySQL需要使用临时表来存储结果集，常见于排序和分组查询。</li>
<li>Using filesort<br> MySQL中无法利用索引完成的排序操作称为“文件排序”。</li>
<li>Using join buffer<br> 改值强调了在获取连接条件时没有使用索引，并且需要连接缓冲区来存储中间结果。如果出现了这个值，那应该注意，根据查询的具体情况可能需要添加索引来改进能。</li>
<li>Impossible where<br> 这个值强调了where语句会导致没有符合条件的行。</li>
<li>Select tables optimized away<br> 这个值意味着仅通过使用索引，优化器可能仅从聚合函数结果中返回一行。</li>
</ol>
<p>详细介绍：<a href="https://segmentfault.com/a/1190000008131735">https://segmentfault.com/a/1190000008131735</a></p>
<h2 id="慢日志查询"><a href="#慢日志查询" class="headerlink" title="慢日志查询"></a>慢日志查询</h2><p>慢查询日志用来记录在 MySQL 中执行时间超过指定时间的查询语句。通过慢查询日志，可以查找出哪些查询语句的执行效率低，以便进行优化。</p>
<p>通俗的说，MySQL 慢查询日志是排查问题的 SQL 语句，以及检查当前 MySQL 性能的一个重要功能。如果不是调优需要，一般不建议启动该参数，因为开启慢查询日志会或多或少带来一定的性能影响。</p>
<h4 id="查询慢日志配置"><a href="#查询慢日志配置" class="headerlink" title="查询慢日志配置"></a>查询慢日志配置</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查看是否开启慢查询日志功能</span></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">variables</span> <span class="keyword">LIKE</span> <span class="string">'slow_query%'</span>;</span><br><span class="line">+<span class="comment">---------------------+---------------------------------------------------------------------+</span></span><br><span class="line">| Variable_name       | Value                                                               |</span><br><span class="line">+<span class="comment">---------------------+---------------------------------------------------------------------+</span></span><br><span class="line">| slow_query_log      | OFF                                                                 |</span><br><span class="line">| slow_query_log_file | C:\ProgramData\MySQL\MySQL Server 5.7\Data\LAPTOP-UHQ6V8KP-slow.log |</span><br><span class="line">+<span class="comment">---------------------+---------------------------------------------------------------------+</span></span><br><span class="line">2 rows in <span class="keyword">set</span>, <span class="number">1</span> <span class="keyword">warning</span> (<span class="number">0.02</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询超过多少秒才记录</span></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">variables</span> <span class="keyword">LIKE</span> <span class="string">'long_query_time'</span>;</span><br><span class="line">+<span class="comment">-----------------+-----------+</span></span><br><span class="line">| Variable_name   | Value     |</span><br><span class="line">+<span class="comment">-----------------+-----------+</span></span><br><span class="line">| long_query_time | 10.000000 |</span><br><span class="line">+<span class="comment">-----------------+-----------+</span></span><br><span class="line">1 row in <span class="keyword">set</span>, <span class="number">1</span> <span class="keyword">warning</span> (<span class="number">0.01</span> sec)</span><br></pre></td></tr></table></figure>
<h4 id="开启慢日志查询"><a href="#开启慢日志查询" class="headerlink" title="开启慢日志查询"></a>开启慢日志查询</h4><p>使用命令开启慢日志查询，只对当前数据库生效，重启MySQL失效。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 开启慢日志查询</span></span><br><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> slow_query_log = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> slow_query_log = <span class="keyword">ON</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 慢查询界定时间（秒）</span></span><br><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> long_query_time = <span class="number">3</span>;</span><br></pre></td></tr></table></figure>
<p>如果需要永久生效，修改 MySQL 配置文件后重启。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line"></span><br><span class="line"># 开启慢日志查询</span><br><span class="line">slow_query_log = 1</span><br><span class="line"></span><br><span class="line"># 慢日志文件存放位置</span><br><span class="line">log-slow-queries=dir\filename</span><br><span class="line"></span><br><span class="line"># 慢查询界定时间（秒）</span><br><span class="line">long_query_time=n</span><br></pre></td></tr></table></figure>
<h4 id="关闭慢日志查询"><a href="#关闭慢日志查询" class="headerlink" title="关闭慢日志查询"></a>关闭慢日志查询</h4><p>使用命令关闭慢日志查询，只对当前数据库生效，重启MySQL失效。<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 关闭慢日志查询</span></span><br><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> slow_query_log = <span class="number">0</span>;</span><br></pre></td></tr></table></figure></p>
<p>如果需要永久生效，修改 MySQL 配置文件后重启。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line"></span><br><span class="line"># 关闭慢日志查询</span><br><span class="line">slow_query_log = 0</span><br></pre></td></tr></table></figure></p>
<h4 id="其他操作"><a href="#其他操作" class="headerlink" title="其他操作"></a>其他操作</h4><p>执行一条 SQL 语句。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">USE</span> <span class="keyword">test</span>;</span><br><span class="line">Database changed</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> tb_student;</span><br><span class="line">+<span class="comment">----+--------+</span></span><br><span class="line">| id | name   |</span><br><span class="line">+<span class="comment">----+--------+</span></span><br><span class="line">|  1 | Java   |</span><br><span class="line">|  2 | MySQL  |</span><br><span class="line">|  3 | Python |</span><br><span class="line">+<span class="comment">----+--------+</span></span><br><span class="line">3 rows in <span class="keyword">set</span> (<span class="number">0.08</span> sec)</span><br></pre></td></tr></table></figure>
<p>打开慢日志文件，可以看到：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># Time: 2020-06-01T01:59:18.368780Z</span><br><span class="line"># User@Host: root[root] @ localhost [::1]  Id:     3</span><br><span class="line"># Query_time: 0.006281  Lock_time: 0.000755 Rows_sent: 2  Rows_examined: 1034</span><br><span class="line">use test;</span><br><span class="line">SET timestamp=1590976758;</span><br><span class="line">SHOW VARIABLES LIKE &apos;slow_query%&apos;;</span><br></pre></td></tr></table></figure>
<p>清空慢日志记录：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqladmin -uroot -p flush-logs</span><br></pre></td></tr></table></figure>
<p>执行该命令后，命令行会提示输入密码。输入正确密码后，将执行删除操作。新的慢查询日志会直接覆盖旧的查询日志，不需要再手动删除。</p>
<p>数据库管理员也可以手工删除慢查询日志，删除之后需要重新启动 MySQL 服务。</p>
<blockquote>
<p>注意：通用查询日志和慢查询日志都是使用这个命令，使用时一定要注意，一旦执行这个命令，通用查询日志和慢查询日志都只存在新的日志文件中。如果需要备份旧的慢查询日志文件，必须先将旧的日志改名，然后重启 MySQL 服务或执行 <code>mysqladmin</code> 命令。</p>
</blockquote>
<h2 id="explain-优化案例"><a href="#explain-优化案例" class="headerlink" title="explain 优化案例"></a>explain 优化案例</h2><h4 id="表结构"><a href="#表结构" class="headerlink" title="表结构"></a>表结构</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`a`</span></span><br><span class="line">(</span><br><span class="line">    <span class="string">`id`</span>          <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> NULLAUTO_INCREMENT,</span><br><span class="line">    <span class="string">`seller_id`</span>   <span class="built_in">bigint</span>(<span class="number">20</span>)                                       <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">    <span class="string">`seller_name`</span> <span class="built_in">varchar</span>(<span class="number">100</span>) <span class="built_in">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_bin <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">    <span class="string">`gmt_create`</span>  <span class="built_in">varchar</span>(<span class="number">30</span>)                                      <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">    PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>)</span><br><span class="line">);</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`b`</span></span><br><span class="line">(</span><br><span class="line">    <span class="string">`id`</span>          <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> NULLAUTO_INCREMENT,</span><br><span class="line">    <span class="string">`seller_name`</span> <span class="built_in">varchar</span>(<span class="number">100</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">    <span class="string">`user_id`</span>     <span class="built_in">varchar</span>(<span class="number">50</span>)  <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">    <span class="string">`user_name`</span>   <span class="built_in">varchar</span>(<span class="number">100</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">    <span class="string">`sales`</span>       <span class="built_in">bigint</span>(<span class="number">20</span>)   <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">    <span class="string">`gmt_create`</span>  <span class="built_in">varchar</span>(<span class="number">30</span>)  <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">    PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>)</span><br><span class="line">);</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`c`</span></span><br><span class="line">(</span><br><span class="line">    <span class="string">`id`</span>         <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> NULLAUTO_INCREMENT,</span><br><span class="line">    <span class="string">`user_id`</span>    <span class="built_in">varchar</span>(<span class="number">50</span>)  <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">    <span class="string">`order_id`</span>   <span class="built_in">varchar</span>(<span class="number">100</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">    <span class="string">`state`</span>      <span class="built_in">bigint</span>(<span class="number">20</span>)   <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">    <span class="string">`gmt_create`</span> <span class="built_in">varchar</span>(<span class="number">30</span>)  <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">    PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<h4 id="待优化-SQL"><a href="#待优化-SQL" class="headerlink" title="待优化 SQL"></a>待优化 SQL</h4><p>三张表关联，查询当前用户在当前时间前后10个小时的订单情况，并根据订单创建时间升序排列，具体SQL如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> a.seller_id,</span><br><span class="line">       a.seller_name,</span><br><span class="line">       b.user_name,</span><br><span class="line">       c.state</span><br><span class="line"><span class="keyword">from</span> a,</span><br><span class="line">     b,</span><br><span class="line">     c</span><br><span class="line"><span class="keyword">where</span> a.seller_name = b.seller_name</span><br><span class="line">  <span class="keyword">and</span> b.user_id = c.user_id</span><br><span class="line">  <span class="keyword">and</span> c.user_id = <span class="number">17</span></span><br><span class="line">  <span class="keyword">and</span> a.gmt_create</span><br><span class="line">    <span class="keyword">BETWEEN</span> <span class="keyword">DATE_ADD</span>(<span class="keyword">NOW</span>(), <span class="built_in">INTERVAL</span> – <span class="number">600</span> <span class="keyword">MINUTE</span>)</span><br><span class="line">    <span class="keyword">AND</span> <span class="keyword">DATE_ADD</span>(<span class="keyword">NOW</span>(), <span class="built_in">INTERVAL</span> <span class="number">600</span> <span class="keyword">MINUTE</span>)</span><br></pre></td></tr></table></figure>
<h4 id="数据量"><a href="#数据量" class="headerlink" title="数据量"></a>数据量</h4><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9tbWJpei5xcGljLmNuL21tYml6X3BuZy9FbnpBd3ZwVFFKNzY5TTZaaWNvbjRWVGdpY2FMdTNyN0s2R2lhY21zTjgySE1JZFh5aWJWWjFOZmhmeUxJOGlhWUl4SU54UFdxa1Nsalh5UFlxSHJOMVU2MWljUS82NDA_d3hfZm10PXBuZw?x-oss-process=image/format,png" alt=""></p>
<h4 id="原执行时间"><a href="#原执行时间" class="headerlink" title="原执行时间"></a>原执行时间</h4><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9tbWJpei5xcGljLmNuL21tYml6X3BuZy9FbnpBd3ZwVFFKNzY5TTZaaWNvbjRWVGdpY2FMdTNyN0s2M0pydlYyMlNWbENuRU1HZm1jSXBxaWNOWGliV2I4elBVbjdLMUVURnIzNWNXdmliQWYzQUlDRjV3LzY0MD93eF9mbXQ9cG5n?x-oss-process=image/format,png" alt=""></p>
<h4 id="原实行计划"><a href="#原实行计划" class="headerlink" title="原实行计划"></a>原实行计划</h4><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9tbWJpei5xcGljLmNuL21tYml6X3BuZy9FbnpBd3ZwVFFKNzY5TTZaaWNvbjRWVGdpY2FMdTNyN0s2YnB2ZVlBUGxqaGlhWVpIaWNWeTh1cW1ycWc1T1l1V0FGM2FURDR0Q3hZaWFUQkVpYVpoUGRKcFIxQS82NDA_d3hfZm10PXBuZw?x-oss-process=image/format,png" alt=""></p>
<h4 id="初步优化思路"><a href="#初步优化思路" class="headerlink" title="初步优化思路"></a>初步优化思路</h4><ol>
<li>SQL 中 <code>where</code> 条件字段类型要跟表结构一致，表中 <code>user_id</code> 为 <code>varchar(50)</code> 类型，实际 SQL 用的 <code>int</code> 类型，存在隐式转换，也未添加索引。将 b 和 c 表 <code>user_id</code> 字段改成 <code>int</code> 类型。</li>
<li>因存在 <code>b</code> 表和 <code>c</code> 表关联，将 <code>b</code> 和 <code>c</code> 表 <code>user_id</code> 创建索引</li>
<li>因存在 <code>a</code> 表和 <code>b</code> 表关联，将 <code>a</code> 和 <code>b</code> 表 <code>seller_name</code> 字段创建索引</li>
<li>利用复合索引消除临时表和排序</li>
</ol>
<h4 id="初步优化SQL"><a href="#初步优化SQL" class="headerlink" title="初步优化SQL"></a>初步优化SQL</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> b <span class="keyword">modify</span> <span class="string">`user_id`</span> <span class="built_in">int</span>(<span class="number">10</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>;</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> c <span class="keyword">modify</span> <span class="string">`user_id`</span> <span class="built_in">int</span>(<span class="number">10</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>;</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> c <span class="keyword">add</span> <span class="keyword">index</span> <span class="string">`idx_user_id`</span>(<span class="string">`user_id`</span>);</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> b <span class="keyword">add</span> <span class="keyword">index</span> <span class="string">`idx_user_id_sell_name`</span>(<span class="string">`user_id`</span>,<span class="string">`seller_name`</span>);</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> a <span class="keyword">add</span> <span class="keyword">index</span> <span class="string">`idx_sellname_gmt_sellid`</span>(<span class="string">`gmt_create`</span>,<span class="string">`seller_name`</span>,<span class="string">`seller_id`</span>);</span><br></pre></td></tr></table></figure>
<h4 id="优化后执行时间"><a href="#优化后执行时间" class="headerlink" title="优化后执行时间"></a>优化后执行时间</h4><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9tbWJpei5xcGljLmNuL21tYml6X3BuZy9FbnpBd3ZwVFFKNzY5TTZaaWNvbjRWVGdpY2FMdTNyN0s2empYMm04ZG4yUDZvbXNTZkwxSFg2UFZKVlVjQUlsR1ZzSTB5cWw1ZWJNdTZIaGROV292aWJSQS82NDA_d3hfZm10PXBuZw?x-oss-process=image/format,png" alt=""></p>
<h4 id="优化后执行计划"><a href="#优化后执行计划" class="headerlink" title="优化后执行计划"></a>优化后执行计划</h4><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9tbWJpei5xcGljLmNuL21tYml6X3BuZy9FbnpBd3ZwVFFKNzY5TTZaaWNvbjRWVGdpY2FMdTNyN0s2dHRsV3U3cENLQlBmZWtPdXdzbnZPOEZpY3gxRmRFbFRSRU9NWlVzUDY2MmV6eWhudXRiNHltZy82NDA_d3hfZm10PXBuZw?x-oss-process=image/format,png" alt=""></p>
<h4 id="查看-warnings-信息"><a href="#查看-warnings-信息" class="headerlink" title="查看 warnings 信息"></a>查看 warnings 信息</h4><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9tbWJpei5xcGljLmNuL21tYml6X3BuZy9FbnpBd3ZwVFFKNzY5TTZaaWNvbjRWVGdpY2FMdTNyN0s2OUk5V29JM1RKRkdrSzJ5cG1YWDdYc2FpY2NzVjhqVDdCUjU5d0JyeTV3a0htRzJ2ZmhMU2Nrdy82NDA_d3hfZm10PXBuZw?x-oss-process=image/format,png" alt=""></p>
<h4 id="继续优化-gmt-create"><a href="#继续优化-gmt-create" class="headerlink" title="继续优化 gmt_create"></a>继续优化 gmt_create</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> a <span class="keyword">modify</span> <span class="string">"gmt_create"</span> datetime <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>;</span><br></pre></td></tr></table></figure>
<h4 id="查看执行时间"><a href="#查看执行时间" class="headerlink" title="查看执行时间"></a>查看执行时间</h4><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9tbWJpei5xcGljLmNuL21tYml6X3BuZy9FbnpBd3ZwVFFKNzY5TTZaaWNvbjRWVGdpY2FMdTNyN0s2UUFNcHh4TzI5R0huOEwxbmhYbmJTc2JBOFRHa2ljY1dpYVBsS3ptNWhLb1k3Q1RpYVRWU1o3U0ZnLzY0MD93eF9mbXQ9cG5n?x-oss-process=image/format,png" alt=""></p>
<h4 id="查看执行计划"><a href="#查看执行计划" class="headerlink" title="查看执行计划"></a>查看执行计划</h4><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9tbWJpei5xcGljLmNuL21tYml6X3BuZy9FbnpBd3ZwVFFKNzY5TTZaaWNvbjRWVGdpY2FMdTNyN0s2enNxUFlXQWlhc0RySThYZXMzT2xGVmV1eXlpY0hmZ0ZhYXVPNlNpYTBCRVhqekhCTjB6RGQzNmliQS82NDA_d3hfZm10PXBuZw?x-oss-process=image/format,png" alt=""></p>
<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><ol>
<li>查看执行计划 <code>explain</code></li>
<li>如果有告警信息，查看告警信息 <code>show warnings</code></li>
<li>查看SQL涉及的表结构和索引信息</li>
<li>根据执行计划，思考可能的优化点</li>
<li>按照可能的优化点执行表结构变更、增加索引、SQL 改写等操作</li>
<li>查看优化后的执行时间和执行计划</li>
<li>如果优化效果不明显，重复第四步操作</li>
</ol>
<h2 id="SHOW-PROCESSLIST"><a href="#SHOW-PROCESSLIST" class="headerlink" title="SHOW PROCESSLIST"></a>SHOW PROCESSLIST</h2><p>显示用户正在运行的线程，需要注意的是，除了 root 用户能看到所有正在运行的线程外，其他用户都只能看到自己正在运行的线程，看不到其它用户正在运行的线程。除非单独个这个用户赋予了 PROCESS 权限。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">PROCESSLIST</span>;</span><br><span class="line"></span><br><span class="line">Id       User        Host                    db                Command  Time  State       Info</span><br><span class="line">30       aurora      100.104.60.243:36747                      Sleep    1		</span><br><span class="line">75       aliyun_root 127.0.0.1:40840                           Sleep    1		</span><br><span class="line">1270     shelflabel  8.129.214.203:47314     shelflabel_test   Sleep    50		</span><br><span class="line">1284     shelflabel  61.141.65.230:53797     shelflabel_test   Query    0     starting    <span class="keyword">SHOW</span> <span class="keyword">PROCESSLIST</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 杀掉 Id = 1284 这个连接</span></span><br><span class="line"><span class="keyword">KILL</span> <span class="number">1284</span>;</span><br></pre></td></tr></table></figure>
<p>参数说明：</p>
<ol>
<li><code>Id</code>：就是这个线程的唯一标识，当我们发现这个线程有问题的时候，可以通过 <code>kill</code> 命令，加上这个 <code>Id</code> 值将这个线程杀掉。</li>
<li><code>User</code>：就是指启动这个线程的用户。</li>
<li><code>Host</code>：记录了发送请求的客户端的 IP 和 端口号。通过这些信息在排查问题的时候，我们可以定位到是哪个客户端的哪个进程发送的请求。</li>
<li><code>DB</code>：当前执行的命令是在哪一个数据库上。如果没有指定数据库，则该值为 <code>NULL</code> 。</li>
<li><code>Command</code>：是指此刻该线程正在执行的命令。</li>
<li><code>Time</code>：表示该线程处于当前状态的时间。</li>
<li><code>State</code>：线程的状态，和 <code>Command</code> 对应。</li>
<li><code>Info</code>：一般记录的是线程执行的语句。</li>
</ol>
<p><code>Command</code> 的值：</p>
<ol>
<li>Binlog Dump：主节点正在将二进制日志，同步到从节点。</li>
<li>Change User：正在执行一个 change-user 的操作。</li>
<li>Close Stmt：正在关闭一个Prepared Statement 对象</li>
<li>Connect: 一个从节点连上了主节点</li>
<li>Connect Out: 一个从节点正在连主节点</li>
<li>Create DB: 正在执行一个create-database 的操作</li>
<li>Daemon: 服务器内部线程，而不是来自客户端的链接</li>
<li>Debug: 线程正在生成调试信息</li>
<li>Delayed Insert: 该线程是一个延迟插入的处理程序</li>
<li>Drop DB: 正在执行一个 drop-database 的操作</li>
<li>Execute: 正在执行一个 Prepared Statement</li>
<li>Fetch: 正在从Prepared Statement 中获取执行结果</li>
<li>Field List: 正在获取表的列信息</li>
<li>Init DB: 该线程正在选取一个默认的数据库</li>
<li>Kill : 正在执行 kill 语句，杀死指定线程</li>
<li>Long Data: 正在从Prepared Statement 中检索 long data</li>
<li>Ping: 正在处理 server-ping 的请求</li>
<li>Prepare: 该线程正在准备一个 Prepared Statement</li>
<li>ProcessList: 该线程正在生成服务器线程相关信息</li>
<li>Query: 该线程正在执行一个语句</li>
<li>Quit: 该线程正在退出</li>
<li>Refresh：该线程正在刷表，日志或缓存；或者在重置状态变量，或者在复制服务器信息</li>
<li>Register Slave： 正在注册从节点</li>
<li>Reset Stmt: 正在重置 prepared statement</li>
<li>Set Option: 正在设置或重置客户端的 statement-execution 选项</li>
<li>Shutdown: 正在关闭服务器</li>
<li>Sleep: 正在等待客户端向它发送执行语句</li>
<li>Statistics: 该线程正在生成 server-status 信息</li>
<li>Table Dump: 正在发送表的内容到从服务器</li>
<li>Time: Unused</li>
</ol>
<h2 id="索引的性能对比"><a href="#索引的性能对比" class="headerlink" title="索引的性能对比"></a>索引的性能对比</h2><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">数据（单进程写）</th>
<th>有索引 MyISAM</th>
<th>无索引 MyISAM</th>
<th>有索引 InnoDB</th>
<th>无索引 InnoDB</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">1 万</td>
<td>6.39s</td>
<td>3.90s</td>
<td>4.99s</td>
<td>4.89s</td>
</tr>
<tr>
<td style="text-align:left">5 万</td>
<td>26.89s</td>
<td>22.73s</td>
<td>29.80s</td>
<td>22.33s</td>
</tr>
<tr>
<td style="text-align:left">10 万</td>
<td>49.55s</td>
<td>34.96s</td>
<td>52.40s</td>
<td>33.21s</td>
</tr>
<tr>
<td style="text-align:left">50 万</td>
<td>189.20s</td>
<td>139.93s</td>
<td>260.78s</td>
<td>200.74s</td>
</tr>
</tbody>
</table>
</div>
<h2 id="存储引擎的性能对比"><a href="#存储引擎的性能对比" class="headerlink" title="存储引擎的性能对比"></a>存储引擎的性能对比</h2><h4 id="单线程写"><a href="#单线程写" class="headerlink" title="单线程写"></a>单线程写</h4><ol>
<li>测试单个线程写入指定数量的数据所消耗的时间。</li>
<li>数据均无索引。</li>
<li>MyISAM 比 InnoDB 快 57%。</li>
</ol>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">数据量</th>
<th>MyISAM</th>
<th>InnoDB</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">1 万</td>
<td>6.39s</td>
<td>4.99s</td>
</tr>
<tr>
<td style="text-align:left">5 万</td>
<td>26.89s</td>
<td>29.80s</td>
</tr>
<tr>
<td style="text-align:left">10 万</td>
<td>49.55s</td>
<td>53.40s</td>
</tr>
<tr>
<td style="text-align:left">50 万</td>
<td>189.20s</td>
<td>260.78s</td>
</tr>
</tbody>
</table>
</div>
<h4 id="多线程写"><a href="#多线程写" class="headerlink" title="多线程写"></a>多线程写</h4><ol>
<li>以每个线程写 1 万条数据为例。</li>
<li>时间为每个线程完成的时间。</li>
<li>MyISAM 比 InnoDB 慢 170% 左右。</li>
</ol>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">进程数</th>
<th>MyISAM</th>
<th>InnoDB</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">20</td>
<td>90.00s</td>
<td>29.66s</td>
</tr>
<tr>
<td style="text-align:left">50</td>
<td>255.89s</td>
<td>74.52</td>
</tr>
<tr>
<td style="text-align:left">100</td>
<td>545.38s</td>
<td>201.94s</td>
</tr>
</tbody>
</table>
</div>
<h4 id="单进程读"><a href="#单进程读" class="headerlink" title="单进程读"></a>单进程读</h4><ol>
<li>MyISAM 比 InnoDB 快 7% 左右。</li>
</ol>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">数据量</th>
<th>MyISAM</th>
<th>InnoDB</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">1 万</td>
<td>67.14</td>
<td>77.15s</td>
</tr>
<tr>
<td style="text-align:left">5 万</td>
<td>110.58s</td>
<td>104.21s</td>
</tr>
<tr>
<td style="text-align:left">10 万</td>
<td>136.02s</td>
<td>146.26s</td>
</tr>
</tbody>
</table>
</div>
<h4 id="多进程读"><a href="#多进程读" class="headerlink" title="多进程读"></a>多进程读</h4><ol>
<li>以每个线程读 5 千条数据为例。</li>
<li>MyISAM 比 InnoDB 慢 10% 左右。</li>
</ol>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">进程数</th>
<th>MyISAM</th>
<th>InnoDB</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">20</td>
<td>140.89s</td>
<td>140.37s</td>
</tr>
<tr>
<td style="text-align:left">50</td>
<td>366.32s</td>
<td>308.76s</td>
</tr>
<tr>
<td style="text-align:left">100</td>
<td>766.37s</td>
<td>615.60s</td>
</tr>
</tbody>
</table>
</div>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Articles</a></li>
         
          <li><a href="/categories/">Categories</a></li>
         
          <li><a href="/search/">Search</a></li>
         
          <li><a href="/about/">About</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#性能指标"><span class="toc-number">1.</span> <span class="toc-text">性能指标</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#QPS"><span class="toc-number">1.0.1.</span> <span class="toc-text">QPS</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#TPS"><span class="toc-number">1.0.2.</span> <span class="toc-text">TPS</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#show-status"><span class="toc-number">2.</span> <span class="toc-text">show status</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Query-Profiler"><span class="toc-number">3.</span> <span class="toc-text">Query Profiler</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#explain"><span class="toc-number">4.</span> <span class="toc-text">explain</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#慢日志查询"><span class="toc-number">5.</span> <span class="toc-text">慢日志查询</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#查询慢日志配置"><span class="toc-number">5.0.1.</span> <span class="toc-text">查询慢日志配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#开启慢日志查询"><span class="toc-number">5.0.2.</span> <span class="toc-text">开启慢日志查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#关闭慢日志查询"><span class="toc-number">5.0.3.</span> <span class="toc-text">关闭慢日志查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#其他操作"><span class="toc-number">5.0.4.</span> <span class="toc-text">其他操作</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#explain-优化案例"><span class="toc-number">6.</span> <span class="toc-text">explain 优化案例</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#表结构"><span class="toc-number">6.0.1.</span> <span class="toc-text">表结构</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#待优化-SQL"><span class="toc-number">6.0.2.</span> <span class="toc-text">待优化 SQL</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#数据量"><span class="toc-number">6.0.3.</span> <span class="toc-text">数据量</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#原执行时间"><span class="toc-number">6.0.4.</span> <span class="toc-text">原执行时间</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#原实行计划"><span class="toc-number">6.0.5.</span> <span class="toc-text">原实行计划</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#初步优化思路"><span class="toc-number">6.0.6.</span> <span class="toc-text">初步优化思路</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#初步优化SQL"><span class="toc-number">6.0.7.</span> <span class="toc-text">初步优化SQL</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#优化后执行时间"><span class="toc-number">6.0.8.</span> <span class="toc-text">优化后执行时间</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#优化后执行计划"><span class="toc-number">6.0.9.</span> <span class="toc-text">优化后执行计划</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#查看-warnings-信息"><span class="toc-number">6.0.10.</span> <span class="toc-text">查看 warnings 信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#继续优化-gmt-create"><span class="toc-number">6.0.11.</span> <span class="toc-text">继续优化 gmt_create</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#查看执行时间"><span class="toc-number">6.0.12.</span> <span class="toc-text">查看执行时间</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#查看执行计划"><span class="toc-number">6.0.13.</span> <span class="toc-text">查看执行计划</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#总结"><span class="toc-number">6.0.14.</span> <span class="toc-text">总结</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SHOW-PROCESSLIST"><span class="toc-number">7.</span> <span class="toc-text">SHOW PROCESSLIST</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#索引的性能对比"><span class="toc-number">8.</span> <span class="toc-text">索引的性能对比</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#存储引擎的性能对比"><span class="toc-number">9.</span> <span class="toc-text">存储引擎的性能对比</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#单线程写"><span class="toc-number">9.0.1.</span> <span class="toc-text">单线程写</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#多线程写"><span class="toc-number">9.0.2.</span> <span class="toc-text">多线程写</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#单进程读"><span class="toc-number">9.0.3.</span> <span class="toc-text">单进程读</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#多进程读"><span class="toc-number">9.0.4.</span> <span class="toc-text">多进程读</span></a></li></ol></li></ol></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://yoursite.com/2020/07/07/数据存储/MySQL 手册/MySQL 性能分析/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://yoursite.com/2020/07/07/数据存储/MySQL 手册/MySQL 性能分析/&text=MySQL 性能分析"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://yoursite.com/2020/07/07/数据存储/MySQL 手册/MySQL 性能分析/&title=MySQL 性能分析"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://yoursite.com/2020/07/07/数据存储/MySQL 手册/MySQL 性能分析/&is_video=false&description=MySQL 性能分析"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=MySQL 性能分析&body=Check out this article: http://yoursite.com/2020/07/07/数据存储/MySQL 手册/MySQL 性能分析/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://yoursite.com/2020/07/07/数据存储/MySQL 手册/MySQL 性能分析/&title=MySQL 性能分析"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://yoursite.com/2020/07/07/数据存储/MySQL 手册/MySQL 性能分析/&title=MySQL 性能分析"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://yoursite.com/2020/07/07/数据存储/MySQL 手册/MySQL 性能分析/&title=MySQL 性能分析"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://yoursite.com/2020/07/07/数据存储/MySQL 手册/MySQL 性能分析/&title=MySQL 性能分析"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://yoursite.com/2020/07/07/数据存储/MySQL 手册/MySQL 性能分析/&name=MySQL 性能分析&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy; 2021 John Doe
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        
        <li><a href="/">Home</a></li>
        
        <li><a href="/archives/">Articles</a></li>
        
        <li><a href="/categories/">Categories</a></li>
        
        <li><a href="/search/">Search</a></li>
        
        <li><a href="/about/">About</a></li>
        
      </ul>
    </nav>
  </div>
</footer>


<!-- 根据页面mathjax变量决定是否加载MathJax数学公式js -->

    </div>
    <!-- styles -->
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
<link rel="stylesheet" href="/lib/justified-gallery/css/justifiedGallery.min.css">

    <!-- jquery -->
<script src="/lib/jquery/jquery.min.js"></script>
<script src="/lib/justified-gallery/js/jquery.justifiedGallery.min.js"></script>
<!-- clipboard -->

  <script src="/lib/clipboard/clipboard.min.js"></script>
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight .code pre").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      target: function(trigger) {
        return trigger.nextElementSibling;
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>

<script src="/js/main.js"></script>
<!-- search -->

<!-- Google Analytics -->

<!-- Baidu Analytics -->

<!-- Disqus Comments -->


</body>
</html>
